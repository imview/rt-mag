(function(n){function h(n,t,i){var r;return t=t.toLowerCase(),(r=n.__allListeners||i&&(n.__allListeners={}))&&(r[t]||i&&(r[t]=[]))}function c(n,t,i,r,u,f){var e=r&&n[t],o;for(e||(e=n[i]);!e&&(o=(o||n).parentNode);){if(o.tagName=="BODY"||f&&!f(o))return null;e=o[i]}return e&&u&&!u(e)?c(e,t,i,!1,u):e}var o,u,v,y,p;UMEDITOR_CONFIG=window.UMEDITOR_CONFIG||{};window.UM={plugins:{},commands:{},I18N:{},version:"1.2.2"};var f=UM.dom={},i=UM.browser=function(){var i=navigator.userAgent.toLowerCase(),e=window.opera,n={ie:/(msie\s|trident.*rv:)([\w.]+)/.test(i),opera:!!e&&e.version,webkit:i.indexOf(" applewebkit/")>-1,mac:i.indexOf("macintosh")>-1,quirks:document.compatMode=="BackCompat"},t,r,u,f;return n.gecko=navigator.product=="Gecko"&&!n.webkit&&!n.opera&&!n.ie,t=0,n.ie&&(r=i.match(/(?:msie\s([\w.]+))/),u=i.match(/(?:trident.*rv:([\w.]+))/),t=r&&u&&r[1]&&u[1]?Math.max(r[1]*1,u[1]*1):r&&r[1]?r[1]*1:u&&u[1]?u[1]*1:0,n.ie11Compat=document.documentMode==11,n.ie9Compat=document.documentMode==9,n.ie8=!!document.documentMode,n.ie8Compat=document.documentMode==8,n.ie7Compat=t==7&&!document.documentMode||document.documentMode==7,n.ie6Compat=t<7||n.quirks,n.ie9above=t>8,n.ie9below=t<9),n.gecko&&(f=i.match(/rv:([\d\.]+)/),f&&(f=f[1].split("."),t=f[0]*1e4+(f[1]||0)*100+(f[2]||0)*1)),/chrome\/(\d+\.\d)/i.test(i)&&(n.chrome=+RegExp.$1),/(\d+\.\d)?(?:\.\d)?\s+safari\/?(\d+\.\d+)?/i.test(i)&&!/chrome/i.test(i)&&(n.safari=+(RegExp.$1||RegExp.$2)),n.opera&&(t=parseFloat(e.version())),n.webkit&&(t=parseFloat(i.match(/ applewebkit\/(\d+)/)[1])),n.version=t,n.isCompatible=!n.mobile&&(n.ie&&t>=6||n.gecko&&t>=10801||n.opera&&t>=9.5||n.air&&t>=1||n.webkit&&t>=522||!1),n}(),e=i.ie,w=i.webkit,b=i.gecko,k=i.opera,r=UM.utils={each:function(n,t,i){var r,f,u;if(n!=null)if(n.length===+n.length){for(r=0,f=n.length;r<f;r++)if(t.call(i,n[r],r,n)===!1)return!1}else for(u in n)if(n.hasOwnProperty(u)&&t.call(i,n[u],u,n)===!1)return!1},makeInstance:function(n){var t=new Function;return t.prototype=n,n=new t,t.prototype=null,n},extend:function(n,t,i){if(t)for(var r in t)i&&n.hasOwnProperty(r)||(n[r]=t[r]);return n},extend2:function(n){for(var r,t,u=arguments,i=1;i<u.length;i++){r=u[i];for(t in r)n.hasOwnProperty(t)||(n[t]=r[t])}return n},inherits:function(n,t){var u=n.prototype,i=r.makeInstance(t.prototype);return r.extend(i,u,!0),n.prototype=i,i.constructor=n},bind:function(n,t){return function(){return n.apply(t,arguments)}},defer:function(n,t,i){var r;return function(){i&&clearTimeout(r);r=setTimeout(n,t)}},indexOf:function(n,t,i){var r=-1;return i=this.isNumber(i)?i:0,this.each(n,function(n,u){if(u>=i&&n===t)return r=u,!1}),r},removeItem:function(n,t){for(var i=0,r=n.length;i<r;i++)n[i]===t&&(n.splice(i,1),i--)},trim:function(n){return n.replace(/(^[ \t\n\r]+)|([ \t\n\r]+$)/g,"")},listToMap:function(n){if(!n)return{};n=r.isArray(n)?n:n.split(",");for(var u=0,t,i={};t=n[u++];)i[t.toUpperCase()]=i[t]=1;return i},unhtml:function(n,t){return n?n.replace(t||/[&<">'](?:(amp|lt|quot|gt|#39|nbsp);)?/g,function(n,t){return t?n:{"<":"&lt;","&":"&amp;",'"':"&quot;",">":"&gt;","'":"&#39;"}[n]}):""},html:function(n){return n?n.replace(/&((g|l|quo)t|amp|#39);/g,function(n){return{"&lt;":"<","&amp;":"&","&quot;":'"',"&gt;":">","&#39;":"'"}[n]}):""},cssStyleToDomStyle:function(){var n=document.createElement("div").style,t={float:n.cssFloat!=undefined?"cssFloat":n.styleFloat!=undefined?"styleFloat":"float"};return function(n){return t[n]||(t[n]=n.toLowerCase().replace(/-./g,function(n){return n.charAt(1).toUpperCase()}))}}(),loadFile:function(){function t(t,i){try{for(var u=0,r;r=n[u++];)if(r.doc===t&&r.url==(i.src||i.href))return r}catch(f){return null}}var n=[];return function(i,r,u){var e=t(i,r),s,f,o;if(e){e.ready?u&&u():e.funs.push(u);return}if(n.push({doc:i,url:r.src||r.href,funs:[u]}),!i.body){s=[];for(o in r)o!="tag"&&s.push(o+'="'+r[o]+'"');i.write("<"+r.tag+" "+s.join(" ")+" ><\/"+r.tag+">");return}if(!r.id||!i.getElementById(r.id)){f=i.createElement(r.tag);delete r.tag;for(o in r)f.setAttribute(o,r[o]);f.onload=f.onreadystatechange=function(){if(!this.readyState||/loaded|complete/.test(this.readyState)){if(e=t(i,r),e.funs.length>0){e.ready=1;for(var n;n=e.funs.pop();)n()}f.onload=f.onreadystatechange=null}};f.onerror=function(){throw Error("The load "+(r.href||r.src)+" fails,check the url settings of file umeditor.config.js ");};i.getElementsByTagName("head")[0].appendChild(f)}}}(),isEmptyObject:function(n){if(n==null)return!0;if(this.isArray(n)||this.isString(n))return n.length===0;for(var t in n)if(n.hasOwnProperty(t))return!1;return!0},fixColor:function(n,t){var r,u,i;if(/color/i.test(n)&&/rgba?/.test(t)){if(r=t.split(","),r.length>3)return"";for(t="#",u=0;i=r[u++];)i=parseInt(i.replace(/[^\d]/gi,""),10).toString(16),t+=i.length==1?"0"+i:i;t=t.toUpperCase()}return t},clone:function(n,t){var u,i;t=t||{};for(i in n)n.hasOwnProperty(i)&&(u=n[i],typeof u=="object"?(t[i]=r.isArray(u)?[]:{},r.clone(n[i],t[i])):t[i]=u);return t},transUnitToPx:function(n){if(!/(pt|cm)/.test(n))return n;var t;n.replace(/([\d.]+)(\w+)/,function(i,r,u){n=r;t=u});switch(t){case"cm":n=parseFloat(n)*25;break;case"pt":n=Math.round(parseFloat(n)*96/72)}return n+(n?"px":"")},cssRule:i.ie&&i.version!=11?function(n,t,i){var r,f,u;if(i=i||document,r=i.indexList?i.indexList:i.indexList={},r[n])u=i.styleSheets[r[n]];else{if(t===undefined)return"";u=i.createStyleSheet("",f=i.styleSheets.length);r[n]=f}if(t===undefined)return u.cssText;u.cssText=t||""}:function(n,t,i){i=i||document;var u=i.getElementsByTagName("head")[0],r;if(!(r=i.getElementById(n))){if(t===undefined)return"";r=i.createElement("style");r.id=n;u.appendChild(r)}if(t===undefined)return r.innerHTML;t!==""?r.innerHTML=t:u.removeChild(r)}};r.each(["String","Function","Array","Number","RegExp","Object"],function(n){UM.utils["is"+n]=function(t){return Object.prototype.toString.apply(t)=="[object "+n+"]"}});o=UM.EventBase=function(){};o.prototype={addListener:function(n,t){n=r.trim(n).split(" ");for(var u=0,i;i=n[u++];)h(this,i,!0).push(t)},removeListener:function(n,t){n=r.trim(n).split(" ");for(var u=0,i;i=n[u++];)r.removeItem(h(this,i)||[],t)},fireEvent:function(){for(var u=arguments[0],f,t,e,n,i,u=r.trim(u).split(" "),o=0;f=u[o++];){if(t=h(this,f),t)for(i=t.length;i--;)if(t[i]){if(n=t[i].apply(this,arguments),n===!0)return n;n!==undefined&&(e=n)}(n=this["on"+f.toLowerCase()])&&(e=n.apply(this,arguments))}return e}};u=f.dtd=function(){function n(n){for(var t in n)n[t.toUpperCase()]=n[t];return n}var i=r.extend2,h=n({isindex:1,fieldset:1}),a=n({input:1,button:1,select:1,textarea:1,label:1}),v=i(n({a:1}),a),c=i({iframe:1},v),e=n({hr:1,ul:1,menu:1,div:1,blockquote:1,noscript:1,table:1,center:1,address:1,dir:1,pre:1,h5:1,dl:1,h4:1,noframes:1,h6:1,ol:1,h1:1,h3:1,h2:1}),y=n({ins:1,del:1,script:1,style:1}),p=i(n({b:1,acronym:1,bdo:1,"var":1,"#":1,abbr:1,code:1,br:1,i:1,cite:1,kbd:1,u:1,strike:1,s:1,tt:1,strong:1,q:1,samp:1,em:1,dfn:1,span:1}),y),w=i(n({sub:1,img:1,embed:1,object:1,sup:1,basefont:1,map:1,applet:1,font:1,big:1,small:1}),p),o=i(n({p:1}),w),b=i(n({iframe:1}),w,a),k=n({img:1,embed:1,noscript:1,br:1,kbd:1,center:1,button:1,basefont:1,h5:1,h4:1,samp:1,h6:1,ol:1,h1:1,h3:1,h2:1,form:1,font:1,"#":1,select:1,menu:1,ins:1,abbr:1,label:1,code:1,table:1,script:1,cite:1,input:1,iframe:1,strong:1,textarea:1,noframes:1,big:1,small:1,span:1,hr:1,sub:1,bdo:1,"var":1,div:1,object:1,sup:1,strike:1,dir:1,map:1,dl:1,applet:1,del:1,isindex:1,fieldset:1,ul:1,b:1,acronym:1,a:1,blockquote:1,i:1,u:1,s:1,tt:1,address:1,q:1,pre:1,p:1,em:1,dfn:1}),t=i(n({a:0}),b),l=n({tr:1}),f=n({"#":1}),d=i(n({param:1}),k),u=i(n({form:1}),h,c,e,o),s=n({li:1,ol:1,ul:1}),it=n({style:1,script:1}),g=n({base:1,link:1,meta:1,title:1}),rt=i(g,it),nt=n({head:1,body:1}),ut=n({html:1}),tt=n({address:1,blockquote:1,center:1,dir:1,div:1,dl:1,fieldset:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,hr:1,isindex:1,menu:1,noframes:1,ol:1,p:1,pre:1,table:1,ul:1}),ft=n({area:1,base:1,basefont:1,br:1,col:1,command:1,dialog:1,embed:1,hr:1,img:1,input:1,isindex:1,keygen:1,link:1,meta:1,param:1,source:1,track:1,wbr:1});return n({$nonBodyContent:i(ut,nt,g),$block:tt,$inline:t,$inlineWithA:i(n({a:1}),t),$body:i(n({script:1,style:1}),tt),$cdata:n({script:1,style:1}),$empty:ft,$nonChild:n({iframe:1,textarea:1}),$listItem:n({dd:1,dt:1,li:1}),$list:n({ul:1,ol:1,dl:1}),$isNotEmpty:n({table:1,ul:1,ol:1,dl:1,iframe:1,area:1,base:1,col:1,hr:1,img:1,embed:1,input:1,link:1,meta:1,param:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1}),$removeEmpty:n({a:1,abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1}),$removeEmptyBlock:n({p:1,div:1}),$tableContent:n({caption:1,col:1,colgroup:1,tbody:1,td:1,tfoot:1,th:1,thead:1,tr:1,table:1}),$notTransContent:n({pre:1,script:1,style:1,textarea:1}),html:nt,head:rt,style:f,script:f,body:u,base:{},link:{},meta:{},title:f,col:{},tr:n({td:1,th:1}),img:{},embed:{},colgroup:n({thead:1,col:1,tbody:1,tr:1,tfoot:1}),noscript:u,td:u,br:{},th:u,center:u,kbd:t,button:i(o,e),basefont:{},h5:t,h4:t,samp:t,h6:t,ol:s,h1:t,h3:t,option:f,h2:t,form:i(h,c,e,o),select:n({optgroup:1,option:1}),font:t,ins:t,menu:s,abbr:t,label:t,table:n({thead:1,col:1,tbody:1,tr:1,colgroup:1,caption:1,tfoot:1}),code:t,tfoot:l,cite:t,li:u,input:{},iframe:u,strong:t,textarea:f,noframes:u,big:t,small:t,span:n({"#":1,br:1,b:1,strong:1,u:1,i:1,em:1,sub:1,sup:1,strike:1,span:1}),hr:t,dt:t,sub:t,optgroup:n({option:1}),param:{},bdo:t,"var":t,div:u,object:d,sup:t,dd:u,strike:t,area:{},dir:s,map:i(n({area:1,form:1,p:1}),h,y,e),applet:d,dl:n({dt:1,dd:1}),del:t,isindex:{},fieldset:i(n({legend:1}),k),thead:l,ul:s,acronym:t,b:t,a:i(n({a:1}),b),blockquote:i(n({td:1,tr:1,tbody:1,li:1}),u),caption:t,i:t,u:t,tbody:l,s:t,address:i(c,o),tt:t,legend:t,q:t,pre:i(p,v),p:i(n({a:1}),t),em:t,dfn:t})}();var l=e&&i.version<9?{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder"}:{tabindex:"tabIndex",readonly:"readOnly"},a=r.listToMap(["-webkit-box","-moz-box","block","list-item","table","table-row-group","table-header-group","table-footer-group","table-row","table-column-group","table-column","table-cell","table-caption"]),t=f.domUtils={NODE_ELEMENT:1,NODE_DOCUMENT:9,NODE_TEXT:3,NODE_COMMENT:8,NODE_DOCUMENT_FRAGMENT:11,POSITION_IDENTICAL:0,POSITION_DISCONNECTED:1,POSITION_FOLLOWING:2,POSITION_PRECEDING:4,POSITION_IS_CONTAINED:8,POSITION_CONTAINS:16,fillChar:e&&i.version=="6"?"﻿":"​",keys:{8:1,46:1,16:1,17:1,18:1,37:1,38:1,39:1,40:1,13:1},breakParent:function(n,i){var r,f=n,o=n,u,e;do{for(f=f.parentNode,u?(r=f.cloneNode(!1),r.appendChild(u),u=r,r=f.cloneNode(!1),r.appendChild(e),e=r):(u=f.cloneNode(!1),e=u.cloneNode(!1));r=o.previousSibling;)u.insertBefore(r,u.firstChild);while(r=o.nextSibling)e.appendChild(r);o=f}while(i!==f);return r=i.parentNode,r.insertBefore(u,i),r.insertBefore(e,i),r.insertBefore(n,e),t.remove(i),n},trimWhiteTextNode:function(n){function i(i){for(var r;(r=n[i])&&r.nodeType==3&&t.isWhitespace(r);)n.removeChild(r)}i("firstChild");i("lastChild")},getPosition:function(n,t){var i,r,u,f;if(n===t)return 0;for(r=[n],u=[t],i=n;i=i.parentNode;){if(i===t)return 10;r.push(i)}for(i=t;i=i.parentNode;){if(i===n)return 20;u.push(i)}if(r.reverse(),u.reverse(),r[0]!==u[0])return 1;for(f=-1;f++,r[f]===u[f];);for(n=r[f],t=u[f];n=n.nextSibling;)if(n===t)return 4;return 2},getNodeIndex:function(n,t){for(var i=n,r=0;i=i.previousSibling;){if(t&&i.nodeType==3){i.nodeType!=i.nextSibling.nodeType&&r++;continue}r++}return r},inDoc:function(n,i){return t.getPosition(n,i)==10},findParent:function(n,i,r){if(n&&!t.isBody(n))for(n=r?n:n.parentNode;n;){if(!i||i(n)||t.isBody(n))return i&&!i(n)&&t.isBody(n)?null:n;n=n.parentNode}return null},findParentByTagName:function(n,i,u,f){return i=r.listToMap(r.isArray(i)?i:[i]),t.findParent(n,function(n){return i[n.tagName]&&!(f&&f(n))},u)},findParents:function(n,i,r,u){for(var f=i&&(r&&r(n)||!r)?[n]:[];n=t.findParent(n,r);)f.push(n);return u?f:f.reverse()},insertAfter:function(n,t){return n.parentNode.insertBefore(t,n.nextSibling)},remove:function(n,t){var i=n.parentNode,r;if(i){if(t&&n.hasChildNodes())while(r=n.firstChild)i.insertBefore(r,n);i.removeChild(n)}return n},getNextDomNode:function(n,t,i,r){return c(n,"firstChild","nextSibling",t,i,r)},getPreDomNode:function(n,t,i,r){return c(n,"lastChild","previousSibling",t,i,r)},isBookmarkNode:function(n){return n.nodeType==1&&n.id&&/^_baidu_bookmark_/i.test(n.id)},getWindow:function(n){var t=n.ownerDocument||n;return t.defaultView||t.parentWindow},getCommonAncestor:function(n,t){if(n===t)return n;for(var u=[n],f=[t],i=n,r=-1;i=i.parentNode;){if(i===t)return i;u.push(i)}for(i=t;i=i.parentNode;){if(i===n)return i;f.push(i)}for(u.reverse(),f.reverse();r++,u[r]===f[r];);return r==0?null:u[r-1]},clearEmptySibling:function(n,i,r){function u(n,i){for(var r;n&&!t.isBookmarkNode(n)&&(t.isEmptyInlineElement(n)||!new RegExp("[^\t\n\r"+t.fillChar+"]").test(n.nodeValue));)r=n[i],t.remove(n),n=r}i||u(n.nextSibling,"nextSibling");r||u(n.previousSibling,"previousSibling")},split:function(n,r){var e=n.ownerDocument,o,u,f;return i.ie&&r==n.nodeValue.length?(o=e.createTextNode(""),t.insertAfter(n,o)):(u=n.splitText(r),i.ie8&&(f=e.createTextNode(""),t.insertAfter(u,f),t.remove(f)),u)},isWhitespace:function(n){return!new RegExp("[^ \t\n\r"+t.fillChar+"]").test(n.nodeValue)},getXY:function(n){for(var t=0,i=0;n.offsetParent;)i+=n.offsetTop,t+=n.offsetLeft,n=n.offsetParent;return{x:t,y:i}},isEmptyInlineElement:function(n){if(n.nodeType!=1||!u.$removeEmpty[n.tagName])return 0;for(n=n.firstChild;n;){if(t.isBookmarkNode(n)||n.nodeType==1&&!t.isEmptyInlineElement(n)||n.nodeType==3&&!t.isWhitespace(n))return 0;n=n.nextSibling}return 1},isBlockElm:function(n){return n.nodeType==1&&(u.$block[n.tagName]||a[t.getComputedStyle(n,"display")])&&!u.$nonChild[n.tagName]},getElementsByTagName:function(t,i,u){var o,f,s,h,c,l,e;for(u&&r.isString(u)&&(o=u,u=function(t){var i=!1;return n.each(r.trim(o).replace(/[ ]{2,}/g," ").split(" "),function(r,u){if(n(t).hasClass(u))return i=!0,!1}),i}),i=r.trim(i).replace(/[ ]{2,}/g," ").split(" "),f=[],s=0;h=i[s++];)for(c=t.getElementsByTagName(h),l=0;e=c[l++];)(!u||u(e))&&f.push(e);return f},unSelectable:e&&i.ie9below||i.opera?function(n){n.onselectstart=function(){return!1};n.onclick=n.onkeyup=n.onkeydown=function(){return!1};n.unselectable="on";n.setAttribute("unselectable","on");for(var i=0,t;t=n.all[i++];)switch(t.tagName.toLowerCase()){case"iframe":case"textarea":case"input":case"select":break;default:t.unselectable="on";n.setAttribute("unselectable","on")}}:function(n){n.style.MozUserSelect=n.style.webkitUserSelect=n.style.msUserSelect=n.style.KhtmlUserSelect="none"},removeAttributes:function(n,t){t=r.isArray(t)?t:r.trim(t).replace(/[ ]{2,}/g," ").split(" ");for(var f=0,u;u=t[f++];){u=l[u]||u;switch(u){case"className":n[u]="";break;case"style":n.style.cssText="";i.ie||n.removeAttributeNode(n.getAttributeNode("style"))}n.removeAttribute(u)}},createElement:function(n,i,r){return t.setAttributes(n.createElement(i),r)},setAttributes:function(n,t){var i,r;for(i in t)if(t.hasOwnProperty(i)){r=t[i];switch(i){case"class":n.className=r;break;case"style":n.style.cssText=n.style.cssText+";"+r;break;case"innerHTML":n[i]=r;break;case"value":n.value=r;break;default:n.setAttribute(l[i]||i,r)}}return n},getComputedStyle:function(t,i){return r.transUnitToPx(r.fixColor(i,n(t).css(i)))},preventDefault:function(n){n.preventDefault?n.preventDefault():n.returnValue=!1},removeStyle:function(n,u){i.ie?(u=="color"&&(u="(^|;)"+u),n.style.cssText=n.style.cssText.replace(new RegExp(u+"[^:]*:[^;]+;?","ig"),"")):n.style.removeProperty?n.style.removeProperty(u):n.style.removeAttribute(r.cssStyleToDomStyle(u));n.style.cssText||t.removeAttributes(n,["style"])},getStyle:function(n,t){var i=n.style[r.cssStyleToDomStyle(t)];return r.fixColor(t,i)},setStyle:function(n,t,i){n.style[r.cssStyleToDomStyle(t)]=i;r.trim(n.style.cssText)||this.removeAttributes(n,"style")},removeDirtyAttr:function(n){for(var i=0,t,r=n.getElementsByTagName("*");t=r[i++];)t.removeAttribute("_moz_dirty");n.removeAttribute("_moz_dirty")},getChildCount:function(n,t){var r=0,i=n.firstChild;for(t=t||function(){return 1};i;)t(i)&&r++,i=i.nextSibling;return r},isEmptyNode:function(n){return!n.firstChild||t.getChildCount(n,function(n){return!t.isBr(n)&&!t.isBookmarkNode(n)&&!t.isWhitespace(n)})==0},isBr:function(n){return n.nodeType==1&&n.tagName=="BR"},isFillChar:function(n,i){return n.nodeType==3&&!n.nodeValue.replace(new RegExp((i?"^":"")+t.fillChar),"").length},isEmptyBlock:function(n,r){if(n.nodeType!=1||(r=r||new RegExp("[ \t\r\n"+t.fillChar+"]","g"),n[i.ie?"innerText":"textContent"].replace(r,"").length>0))return 0;for(var f in u.$isNotEmpty)if(n.getElementsByTagName(f).length)return 0;return 1},isCustomeNode:function(n){return n.nodeType==1&&n.getAttribute("_ue_custom_node_")},fillNode:function(n,r){var u=i.ie?n.createTextNode(t.fillChar):n.createElement("br");r.innerHTML="";r.appendChild(u)},isBoundaryNode:function(n,i){for(var r;!t.isBody(n);)if(r=n,n=n.parentNode,r!==n[i])return!1;return!0},isFillChar:function(n,i){return n.nodeType==3&&!n.nodeValue.replace(new RegExp((i?"^":"")+t.fillChar),"").length},isBody:function(t){return n(t).hasClass("edui-body-container")}},s=new RegExp(t.fillChar,"g");(function(){function v(n){n.collapsed=n.startContainer&&n.endContainer&&n.startContainer===n.endContainer&&n.startOffset==n.endOffset}function y(n){return!n.collapsed&&n.startContainer.nodeType==1&&n.startContainer===n.endContainer&&n.endOffset-n.startOffset==1}function c(n,i,r,f){return i.nodeType==1&&(u.$empty[i.tagName]||u.$nonChild[i.tagName])&&(r=t.getNodeIndex(i)+(n?0:1),i=i.parentNode),n?(f.startContainer=i,f.startOffset=r,f.endContainer||f.collapse(!0)):(f.endContainer=i,f.endOffset=r,f.startContainer||f.collapse(!1)),v(f),f}function a(n,u){try{if(r&&t.inDoc(r,n))if(r.nodeValue.replace(s,"").length)r.nodeValue=r.nodeValue.replace(s,"");else{var f=r.parentNode;for(t.remove(r);f&&t.isEmptyInlineElement(f)&&(i.safari?!(t.getPosition(f,u)&t.POSITION_CONTAINS):!f.contains(u));)r=f.parentNode,t.remove(f),f=r}}catch(e){}}function e(n,i){var r;for(n=n[i];n&&t.isFillChar(n);)r=n[i],t.remove(n),n=r}function p(n,i){var r=n.startContainer,o=n.endContainer,s=n.startOffset,w=n.endOffset,l=n.document,b=l.createDocumentFragment(),k,d,f,y,h,p;if(r.nodeType==1&&(r=r.childNodes[s]||(k=r.appendChild(l.createTextNode("")))),o.nodeType==1&&(o=o.childNodes[w]||(d=o.appendChild(l.createTextNode("")))),r===o&&r.nodeType==3)return b.appendChild(l.createTextNode(r.substringData(s,w-s))),i&&(r.deleteData(s,w-s),n.collapse(!0)),b;var u,a,e=b,c=t.findParents(r,!0),v=t.findParents(o,!0);for(f=0;c[f]==v[f];)f++;for(h=f;y=c[h];h++){for(u=y.nextSibling,y==r?k||(n.startContainer.nodeType==3?(e.appendChild(l.createTextNode(r.nodeValue.slice(s))),i&&r.deleteData(s,r.nodeValue.length-s)):e.appendChild(i?r:r.cloneNode(!0))):(a=y.cloneNode(!1),e.appendChild(a));u;){if(u===o||u===v[h])break;y=u.nextSibling;e.appendChild(i?u:u.cloneNode(!0));u=y}e=a}for(e=b,c[f]||(e.appendChild(c[f-1].cloneNode(!1)),e=e.firstChild),h=f;p=v[h];h++){if(u=p.previousSibling,p==o?d||n.endContainer.nodeType!=3||(e.appendChild(l.createTextNode(o.substringData(0,w))),i&&o.deleteData(0,w)):(a=p.cloneNode(!1),e.appendChild(a)),h!=f||!c[f])while(u){if(u===r)break;p=u.previousSibling;e.insertBefore(i?u:u.cloneNode(!0),e.firstChild);u=p}e=a}return i&&n.setStartBefore(v[f]?c[f]?v[f]:c[f-1]:v[f-1]).collapse(!0),k&&t.remove(k),d&&t.remove(d),b}var h=0,o=t.fillChar,r,l=f.Range=function(n,t){var i=this;i.startContainer=i.startOffset=i.endContainer=i.endOffset=null;i.document=n;i.collapsed=!0;i.body=t};l.prototype={deleteContents:function(){var n;return this.collapsed||p(this,1),i.webkit&&(n=this.startContainer,n.nodeType!=3||n.nodeValue.length||(this.setStartBefore(n).collapse(!0),t.remove(n))),this},inFillChar:function(){var n=this.startContainer;return this.collapsed&&n.nodeType==3&&n.nodeValue.replace(new RegExp("^"+t.fillChar),"").length+1==n.nodeValue.length?!0:!1},setStart:function(n,t){return c(!0,n,t,this)},setEnd:function(n,t){return c(!1,n,t,this)},setStartAfter:function(n){return this.setStart(n.parentNode,t.getNodeIndex(n)+1)},setStartBefore:function(n){return this.setStart(n.parentNode,t.getNodeIndex(n))},setEndAfter:function(n){return this.setEnd(n.parentNode,t.getNodeIndex(n)+1)},setEndBefore:function(n){return this.setEnd(n.parentNode,t.getNodeIndex(n))},setStartAtFirst:function(n){return this.setStart(n,0)},setStartAtLast:function(n){return this.setStart(n,n.nodeType==3?n.nodeValue.length:n.childNodes.length)},setEndAtFirst:function(n){return this.setEnd(n,0)},setEndAtLast:function(n){return this.setEnd(n,n.nodeType==3?n.nodeValue.length:n.childNodes.length)},selectNode:function(n){return this.setStartBefore(n).setEndAfter(n)},selectNodeContents:function(n){return this.setStart(n,0).setEndAtLast(n)},cloneRange:function(){var n=this;return new l(n.document).setStart(n.startContainer,n.startOffset).setEnd(n.endContainer,n.endOffset)},collapse:function(n){var t=this;return n?(t.endContainer=t.startContainer,t.endOffset=t.startOffset):(t.startContainer=t.endContainer,t.startOffset=t.endOffset),t.collapsed=!0,t},shrinkBoundary:function(n){function f(n){return n.nodeType==1&&!t.isBookmarkNode(n)&&!u.$empty[n.tagName]&&!u.$nonChild[n.tagName]}for(var i=this,r,e=i.collapsed;i.startContainer.nodeType==1&&(r=i.startContainer.childNodes[i.startOffset])&&f(r);)i.setStart(r,0);if(e)return i.collapse(!0);if(!n)while(i.endContainer.nodeType==1&&i.endOffset>0&&(r=i.endContainer.childNodes[i.endOffset-1])&&f(r))i.setEnd(r,r.childNodes.length);return i},trimBoundary:function(n){var f;this.txtToElmBoundary();var u=this.startContainer,i=this.startOffset,e=this.collapsed,r=this.endContainer;return u.nodeType==3&&(i==0?this.setStartBefore(u):i>=u.nodeValue.length?this.setStartAfter(u):(f=t.split(u,i),u===r?this.setEnd(f,this.endOffset-i):u.parentNode===r&&(this.endOffset+=1),this.setStartBefore(f)),e)?this.collapse(!0):(n||(i=this.endOffset,r=this.endContainer,r.nodeType==3&&(i==0?this.setEndBefore(r):(i<r.nodeValue.length&&t.split(r,i),this.setEndAfter(r)))),this)},txtToElmBoundary:function(n){function t(n,t){var i=n[t+"Container"],r=n[t+"Offset"];i.nodeType==3&&(r?r>=i.nodeValue.length&&n["set"+t.replace(/(\w)/,function(n){return n.toUpperCase()})+"After"](i):n["set"+t.replace(/(\w)/,function(n){return n.toUpperCase()})+"Before"](i))}return(n||!this.collapsed)&&(t(this,"start"),t(this,"end")),this},insertNode:function(n){var t=n,r=1;n.nodeType==11&&(t=n.firstChild,r=n.childNodes.length);this.trimBoundary(!0);var i=this.startContainer,f=this.startOffset,u=i.childNodes[f];return u?i.insertBefore(n,u):i.appendChild(n),t.parentNode===this.endContainer&&(this.endOffset=this.endOffset+r),this.setStartBefore(t)},setCursor:function(n,t){return this.collapse(!n).select(t)},createBookmark:function(n,t){var i,r=this.document.createElement("span");return r.style.cssText="display:none;line-height:0px;",r.appendChild(this.document.createTextNode("‍")),r.id="_baidu_bookmark_start_"+(t?"":h++),this.collapsed||(i=r.cloneNode(!0),i.id="_baidu_bookmark_end_"+(t?"":h++)),this.insertNode(r),i&&this.collapse().insertNode(i).setEndBefore(i),this.setStartAfter(r),{start:n?r.id:r,end:i?n?i.id:i:null,id:n}},moveToBookmark:function(n){var r=n.id?this.document.getElementById(n.start):n.start,i=n.end&&n.id?this.document.getElementById(n.end):n.end;return this.setStartBefore(r),t.remove(r),i?(this.setEndBefore(i),t.remove(i)):this.collapse(!0),this},adjustmentBoundary:function(){if(!this.collapsed){while(!t.isBody(this.startContainer)&&this.startOffset==this.startContainer[this.startContainer.nodeType==3?"nodeValue":"childNodes"].length&&this.startContainer[this.startContainer.nodeType==3?"nodeValue":"childNodes"].length)this.setStartAfter(this.startContainer);while(!t.isBody(this.endContainer)&&!this.endOffset&&this.endContainer[this.endContainer.nodeType==3?"nodeValue":"childNodes"].length)this.setEndBefore(this.endContainer)}return this},getClosedNode:function(){var i,t,n;return this.collapsed||(t=this.cloneRange().adjustmentBoundary().shrinkBoundary(),y(t)&&(n=t.startContainer.childNodes[t.startOffset],n&&n.nodeType==1&&(u.$empty[n.tagName]||u.$nonChild[n.tagName])&&(i=n))),i},select:i.ie?function(n,i){var u,l,h,f,y,v,c,s;if(this.collapsed||this.shrinkBoundary(),l=this.getClosedNode(),l&&!i){try{u=this.document.body.createControlRange();u.addElement(l);u.select()}catch(p){}return this}h=this.createBookmark();f=h.start;u=this.document.body.createTextRange();u.moveToElementText(f);u.moveStart("character",1);this.collapsed?n||this.startContainer.nodeType==3||(c=this.document.createTextNode(o),s=this.document.createElement("span"),s.appendChild(this.document.createTextNode(o)),f.parentNode.insertBefore(s,f),f.parentNode.insertBefore(c,f),a(this.document,c),r=c,e(s,"previousSibling"),e(f,"nextSibling"),u.moveStart("character",-1),u.collapse(!0)):(v=this.document.body.createTextRange(),y=h.end,v.moveToElementText(y),u.setEndPoint("EndToEnd",v));this.moveToBookmark(h);s&&t.remove(s);try{u.select()}catch(p){}return this}:function(n){function v(n){function t(t,i,r){t.nodeType==3&&t.nodeValue.length<i&&(n[r+"Offset"]=t.nodeValue.length)}t(n.startContainer,n.startOffset,"start");t(n.endContainer,n.endOffset,"end")}var l=t.getWindow(this.document),c=l.getSelection(),f,s,h,u;if(i.gecko?this.body.focus():l.focus(),c){if(c.removeAllRanges(),this.collapsed&&!n&&(s=this.startContainer,u=s,s.nodeType==1&&(u=s.childNodes[this.startOffset]),s.nodeType==3&&this.startOffset||(u?u.previousSibling&&u.previousSibling.nodeType==3:s.lastChild&&s.lastChild.nodeType==3)||(f=this.document.createTextNode(o),this.insertNode(f),a(this.document,f),e(f,"previousSibling"),e(f,"nextSibling"),r=f,this.setStart(f,i.webkit?1:0).collapse(!0))),h=this.document.createRange(),this.collapsed&&i.opera&&this.startContainer.nodeType==1)if(u=this.startContainer.childNodes[this.startOffset],u){while(u&&t.isBlockElm(u))if(u.nodeType==1&&u.childNodes[0])u=u.childNodes[0];else break;u&&this.setStartBefore(u).collapse(!0)}else u=this.startContainer.lastChild,u&&t.isBr(u)&&this.setStartBefore(u).collapse(!0);v(this);h.setStart(this.startContainer,this.startOffset);h.setEnd(this.endContainer,this.endOffset);c.addRange(h)}return this},createAddress:function(n,i){function f(n){for(var e,o,u,f=n?r.startContainer:r.endContainer,l=t.findParents(f,!0,function(n){return!t.isBody(n)}),h=[],a=0,c;c=l[a++];)h.push(t.getNodeIndex(c,i));if(e=0,i)if(f.nodeType==3){for(o=f.previousSibling;o&&o.nodeType==3;)e+=o.nodeValue.replace(s,"").length,o=o.previousSibling;e+=n?r.startOffset:r.endOffset}else if(f=f.childNodes[n?r.startOffset:r.endOffset],f)e=t.getNodeIndex(f,i);else for(f=n?r.startContainer:r.endContainer,u=f.firstChild;u;){if(t.isFillChar(u)){u=u.nextSibling;continue}if(e++,u.nodeType==3)while(u&&u.nodeType==3)u=u.nextSibling;else u=u.nextSibling}else e=n?t.isFillChar(f)?0:r.startOffset:r.endOffset;return e<0&&(e=0),h.push(e),h}var u={},r=this;return u.startAddress=f(!0),n||(u.endAddress=r.collapsed?[].concat(u.startAddress):f()),u},moveToAddress:function(n,t){function r(n,t){for(var r=i.body,u,f,e=0,o,s=n.length;e<s;e++)if(o=n[e],u=r,r=r.childNodes[o],!r){f=o;break}t?r?i.setStartBefore(r):i.setStart(u,f):r?i.setEndBefore(r):i.setEnd(u,f)}var i=this;return r(n.startAddress,!0),!t&&n.endAddress&&r(n.endAddress),i},equals:function(n){for(var t in this)if(this.hasOwnProperty(t)&&this[t]!==n[t])return!1;return!0},scrollIntoView:function(){var i=n('<span style="padding:0;margin:0;display:block;border:0">&nbsp;<\/span>');this.cloneRange().insertNode(i.get(0));var r=n(window).scrollTop(),u=n(window).height(),t=i.offset().top;(t<r-u||t>r+u)&&(t>r+u?window.scrollTo(0,t-u+i.height()):window.scrollTo(0,r-t));i.remove()},getOffset:function(){var t=this.createBookmark(),i=n(t.start).css("display","inline-block").offset();return this.moveToBookmark(t),i}}})(),function(){function e(n,i){var l=t.getNodeIndex,e,o,y,p;if(n=n.duplicate(),n.collapse(i),e=n.parentElement(),!e.hasChildNodes())return{container:e,offset:0};for(var s=e.children,r,h=n.duplicate(),a=0,v=s.length-1,c=-1,f;a<=v;)if(c=Math.floor((a+v)/2),r=s[c],h.moveToElementText(r),o=h.compareEndPoints("StartToStart",n),o>0)v=c-1;else if(o<0)a=c+1;else return{container:e,offset:l(r)};if(c==-1){if(h.moveToElementText(e),h.setEndPoint("StartToStart",n),f=h.text.replace(/(\r\n|\r)/g,"\n").length,s=e.childNodes,!f)return r=s[s.length-1],{container:r,offset:r.nodeValue.length};for(y=s.length;f>0;)f-=s[--y].nodeValue.length;return{container:s[y],offset:-f}}if(h.collapse(o>0),h.setEndPoint(o>0?"StartToStart":"EndToStart",n),f=h.text.replace(/(\r\n|\r)/g,"\n").length,!f)return u.$empty[r.tagName]||u.$nonChild[r.tagName]?{container:e,offset:l(r)+(o>0?0:1)}:{container:r,offset:o>0?0:r.childNodes.length};while(f>0)try{p=r;r=r[o>0?"previousSibling":"nextSibling"];f-=r.nodeValue.length}catch(w){return{container:e,offset:l(p)}}return{container:r,offset:o>0?-f:r.nodeValue.length+f}}function o(n,t){if(n.item)t.selectNode(n.item(0));else{var i=e(n,!0);t.setStart(i.container,i.offset);n.compareEndPoints("StartToEnd",n)!=0&&(i=e(n,!1),t.setEnd(i.container,i.offset))}return t}function r(n,t){var i,r;try{i=n.getNative(t).createRange()}catch(u){return null}return(r=i.item?i.item(0):i.parentElement(),(r.ownerDocument||r)===n.document)?i:null}var s=f.Selection=function(t,u){var f=this;if(f.document=t,f.body=u,i.ie9below)n(u).on("beforedeactivate",function(){f._bakIERange=f.getIERange()}).on("activate",function(){try{var n=r(f);n&&f.rangeInBody(n)||!f._bakIERange||f._bakIERange.select()}catch(t){}f._bakIERange=null})};s.prototype={hasNativeRange:function(){var n,t;if(!i.ie||i.ie9above){if(t=this.getNative(),!t.rangeCount)return!1;n=t.getRangeAt(0)}else n=r(this);return this.rangeInBody(n)},getNative:function(n){var r=this.document;try{return r?i.ie9below||n?r.selection:t.getWindow(r).getSelection():null}catch(u){return null}},getIERange:function(n){var t=r(this,n);return(!t||!this.rangeInBody(t,n))&&this._bakIERange?this._bakIERange:t},rangeInBody:function(n,r){var u=i.ie9below||r?n.item?n.item():n.parentElement():n.startContainer;return u===this.body||t.inDoc(u,this.body)},cache:function(){this.clear();this._cachedRange=this.getRange();this._cachedStartElement=this.getStart();this._cachedStartElementPath=this.getStartElementPath()},getStartElementPath:function(){if(this._cachedStartElementPath)return this._cachedStartElementPath;var n=this.getStart();return n?t.findParents(n,!0,null,!0):[]},clear:function(){this._cachedStartElementPath=this._cachedRange=this._cachedStartElement=null},isFocus:function(){return this.hasNativeRange()},getRange:function(){function e(n){for(var t=r.body.firstChild,i=n.collapsed;t&&t.firstChild;)n.setStart(t,0),t=t.firstChild;n.startContainer||n.setStart(r.body,0);i&&n.collapse(!0)}var r=this,n,s,u,h,c;if(r._cachedRange!=null)return this._cachedRange;if(n=new f.Range(r.document,r.body),i.ie9below)if(s=r.getIERange(),s&&this.rangeInBody(s))try{o(s,n)}catch(l){e(n)}else e(n);else if(u=r.getNative(),u&&u.rangeCount&&r.rangeInBody(u.getRangeAt(0)))h=u.getRangeAt(0),c=u.getRangeAt(u.rangeCount-1),n.setStart(h.startContainer,h.startOffset).setEnd(c.endContainer,c.endOffset),n.collapsed&&t.isBody(n.startContainer)&&!n.startOffset&&e(n);else{if(this._bakRange&&(this._bakRange.startContainer===this.body||t.inDoc(this._bakRange.startContainer,this.body)))return this._bakRange;e(n)}return this._bakRange=n},getStart:function(){if(this._cachedStartElement)return this._cachedStartElement;var t=i.ie9below?this.getIERange():this.getRange(),r,n,u,f;if(i.ie9below){if(!t)return this.document.body.firstChild;if(t.item)return t.item(0);for(r=t.duplicate(),r.text.length>0&&r.moveStart("character",1),r.collapse(1),n=r.parentElement(),f=u=t.parentElement();u=u.parentNode;)if(u==n){n=f;break}}else if(n=t.startContainer,n.nodeType==1&&n.hasChildNodes()&&(n=n.childNodes[Math.min(n.childNodes.length-1,t.startOffset)]),n.nodeType==3)return n.parentNode;return n},getText:function(){var n,t;return this.isFocus()&&(n=this.getNative())?(t=i.ie9below?n.createRange():n.getRangeAt(0),i.ie9below?t.text:t.toString()):""}}}(),function(){function s(n,i){var u,e,f,o;if(i.textarea)if(r.isString(i.textarea)){for(e=0,o=t.getElementsByTagName(n,"textarea");f=o[e++];)if(f.id=="umeditor_textarea_"+i.options.textarea){u=f;break}}else u=i.textarea;u||(n.appendChild(u=t.createElement(document,"textarea",{name:i.options.textarea,id:"umeditor_textarea_"+i.options.textarea,style:"display:none"})),i.textarea=u);u.value=i.hasContents()?i.options.allHtmlEnabled?i.getAllHtml():i.getContent(null,null,!0):""}function c(n){for(var t in UM.plugins)n.options.excludePlugins.indexOf(t)==-1&&(UM.plugins[t].call(n),n.plugins[t]=1);n.langIsReady=!0;n.fireEvent("langReady")}function v(n){for(var t in n)return t}var a=0,h,l=UM.Editor=function(n){var t=this;t.uid=a++;o.call(t);t.commands={};t.options=r.extend(r.clone(n||{}),UMEDITOR_CONFIG,!0);t.shortcutkeys={};t.inputRules=[];t.outputRules=[];t.setOpt({isShow:!0,initialContent:"",initialStyle:"",autoClearinitialContent:!1,textarea:"editorValue",focus:!1,focusInEnd:!0,autoClearEmptyNode:!0,fullscreen:!1,readonly:!1,zIndex:999,enterTag:"p",lang:"zh-cn",langPath:t.options.UMEDITOR_HOME_URL+"lang/",theme:"default",themePath:t.options.UMEDITOR_HOME_URL+"themes/",allHtmlEnabled:!1,autoSyncData:!0,autoHeightEnabled:!0,excludePlugins:""});t.plugins={};r.isEmptyObject(UM.I18N)?r.loadFile(document,{src:t.options.langPath+t.options.lang+"/"+t.options.lang+".js",tag:"script",type:"text/javascript",defer:"defer"},function(){c(t)}):(t.options.lang=v(UM.I18N),c(t))};l.prototype={ready:function(n){var t=this;n&&(t.isReady?n.apply(t):t.addListener("ready",n))},setOpt:function(n,t){var i={};r.isString(n)?i[n]=t:i=n;r.extend(this.options,i,!0)},getOpt:function(n){return this.options[n]||""},destroy:function(){var i=this,u,r,f;i.fireEvent("destroy");u=i.container.parentNode;u===document.body&&(u=i.container);r=i.textarea;r?r.style.display="":(r=document.createElement("textarea"),u.parentNode.insertBefore(r,u));r.style.width=i.body.offsetWidth+"px";r.style.height=i.body.offsetHeight+"px";r.value=i.getContent();r.id=i.key;u.contains(r)&&n(r).insertBefore(u);u.innerHTML="";t.remove(u);UM.clearCache(i.id);for(f in i)i.hasOwnProperty(f)&&delete this[f]},initialCont:function(n){if(n){if(n.getAttribute("name")&&(this.options.textarea=n.getAttribute("name")),n&&/script|textarea/ig.test(n.tagName)){var t=document.createElement("div");n.parentNode.insertBefore(t,n);this.options.initialContent=UM.htmlparser(n.value||n.innerHTML||this.options.initialContent).toHtml();n.className&&(t.className=n.className);n.style.cssText&&(t.style.cssText=n.style.cssText);/textarea/i.test(n.tagName)?(this.textarea=n,this.textarea.style.display="none"):(n.parentNode.removeChild(n),n.id&&(t.id=n.id));n=t;n.innerHTML=""}return n}return null},render:function(t){var o=this,u=o.options,e=function(i){return parseInt(n(t).css(i))},f;r.isString(t)&&(t=document.getElementById(t));t&&(this.id=t.getAttribute("id"),UM.setEditor(this),r.cssRule("edui-style-body",o.options.initialStyle,document),t=this.initialCont(t),t.className+=" edui-body-container",u.minFrameWidth=u.initialFrameWidth?u.initialFrameWidth:u.initialFrameWidth=n(t).width()||UM.defaultWidth,u.initialFrameHeight?u.minFrameHeight=u.initialFrameHeight:u.initialFrameHeight=u.minFrameHeight=n(t).height()||UM.defaultHeight,t.style.width=/%$/.test(u.initialFrameWidth)?"100%":u.initialFrameWidth-e("padding-left")-e("padding-right")+"px",f=/%$/.test(u.initialFrameHeight)?"100%":u.initialFrameHeight-e("padding-top")-e("padding-bottom"),this.options.autoHeightEnabled?(t.style.minHeight=f+"px",t.style.height="",i.ie&&i.version<=6&&(t.style.height=f,t.style.setExpression("height","this.scrollHeight <= "+f+' ? "'+f+'px" : "auto"'))):n(t).height(f),t.style.zIndex=u.zIndex,this._setup(t))},_setup:function(r){var u=this,e=u.options,h,o,c;for(r.contentEditable=!0,document.body.spellcheck=!1,u.document=document,u.window=document.defaultView||document.parentWindow,u.body=r,u.$body=n(r),u.selection=new f.Selection(document,u.body),u._isEnabled=!1,i.gecko&&(h=this.selection.getNative())&&h.removeAllRanges(),this._initEvents(),o=r.parentNode;o&&!t.isBody(o);o=o.parentNode)if(o.tagName=="FORM"){if(u.form=o,u.options.autoSyncData)n(r).on("blur",function(){s(o,u)});else n(o).on("submit",function(){s(this,u)});break}if(e.initialContent&&(e.autoClearinitialContent?(c=u.execCommand,u.execCommand=function(){return u.fireEvent("firstBeforeExecCommand"),c.apply(u,arguments)},this._setDefaultContent(e.initialContent)):this.setContent(e.initialContent,!1,!0)),t.isEmptyNode(u.body)&&(u.body.innerHTML="<p>"+(i.ie?"":"<br/>")+"<\/p>"),e.focus&&setTimeout(function(){u.focus(u.options.focusInEnd);u.options.autoClearinitialContent||u._selectionChange()},0),u.container||(u.container=r.parentNode),u._bindshortcutKeys(),u.isReady=1,u.fireEvent("ready"),e.onready&&e.onready.call(u),!i.ie||i.ie9above)n(u.body).on("blur focus",function(n){var t=u.selection.getNative();if(n.type=="blur")t.rangeCount>0&&(u._bakRange=t.getRangeAt(0));else{try{u._bakRange&&t.addRange(u._bakRange)}catch(n){}u._bakRange=null}});e.isShow||u.setHide();e.readonly&&u.setDisabled()},sync:function(n){var i=this,r=n?document.getElementById(n):t.findParent(i.body.parentNode,function(n){return n.tagName=="FORM"},!0);r&&s(r,i)},setHeight:function(t,r){r||(this.options.initialFrameHeight=t);this.options.autoHeightEnabled?(n(this.body).css({"min-height":t+"px"}),i.ie&&i.version<=6&&this.container&&(this.container.style.height=t,this.container.style.setExpression("height","this.scrollHeight <= "+t+' ? "'+t+'px" : "auto"'))):n(this.body).height(t);this.fireEvent("resize")},setWidth:function(t){this.$container&&this.$container.width(t);n(this.body).width(t-n(this.body).css("padding-left").replace("px","")*1-n(this.body).css("padding-right").replace("px","")*1);this.fireEvent("resize")},addshortcutkey:function(n,t){var i={};t?i[n]=t:i=n;r.extend(this.shortcutkeys,i)},_bindshortcutKeys:function(){var n=this,i=this.shortcutkeys;n.addListener("keydown",function(r,u){var h=u.keyCode||u.which,e,c,l,f,o,s;for(e in i)for(c=i[e].split(","),l=0;f=c[l++];)f=f.split(":"),o=f[0],s=f[1],(/^(ctrl)(\+shift)?\+(\d+)$/.test(o.toLowerCase())||/^(\d+)$/.test(o))&&((RegExp.$1=="ctrl"?u.ctrlKey||u.metaKey:0)&&(RegExp.$2!=""?u[RegExp.$2.slice(1)+"Key"]:1)&&h==RegExp.$3||h==RegExp.$1)&&(n.queryCommandState(e,s)!=-1&&n.execCommand(e,s),t.preventDefault(u))})},getContent:function(n,t,i,u,f){var e=this,o;return(n&&r.isFunction(n)&&(t=n,n=""),t?!t():!this.hasContents())?"":(e.fireEvent("beforegetcontent"),o=UM.htmlparser(e.body.innerHTML,u),e.filterOutputRule(o),e.fireEvent("aftergetcontent",o),o.toHtml(f))},getAllHtml:function(){var n=this,u=[],t;return n.fireEvent("getAllHtml",u),i.ie&&i.version>8&&(t="",r.each(n.document.styleSheets,function(n){t+=n.href?'<link rel="stylesheet" type="text/css" href="'+n.href+'" />':"<style>"+n.cssText+"<\/style>"}),r.each(n.document.getElementsByTagName("script"),function(n){t+=n.outerHTML})),"<html><head>"+(n.options.charset?'<meta http-equiv="Content-Type" content="text/html; charset='+n.options.charset+'"/>':"")+(t||n.document.getElementsByTagName("head")[0].innerHTML)+u.join("\n")+"<\/head><body "+(e&&i.version<9?'class="view"':"")+">"+n.getContent(null,null,!0)+"<\/body><\/html>"},getPlainTxt:function(){var i=new RegExp(t.fillChar,"g"),n=this.body.innerHTML.replace(/[\n\r]/g,"");return n=n.replace(/<(p|div)[^>]*>(<br\/?>|&nbsp;)<\/\1>/gi,"\n").replace(/<br\/?>/gi,"\n").replace(/<[^>/]+>/g,"").replace(/(\n)?<\/([^>]+)>/g,function(n,t,i){return u.$block[i]?"\n":t?t:""}),n.replace(i,"").replace(/\u00a0/g," ").replace(/&nbsp;/g," ")},getContentTxt:function(){var n=new RegExp(t.fillChar,"g");return this.body[i.ie?"innerText":"textContent"].replace(n,"").replace(/\u00a0/g," ")},setContent:function(n,r,f){function v(n){return n.tagName=="DIV"&&n.getAttribute("cdata_tag")}var o=this,c,e,l,h,a;if(o.fireEvent("beforesetcontent",n),c=UM.htmlparser(n),o.filterInputRule(c),n=c.toHtml(),o.body.innerHTML=(r?o.body.innerHTML:"")+n,o.options.enterTag=="p")if(e=this.body.firstChild,!e||e.nodeType==1&&(u.$cdata[e.tagName]||v(e)||t.isCustomeNode(e))&&e===this.body.lastChild)this.body.innerHTML="<p>"+(i.ie?"&nbsp;":"<br/>")+"<\/p>"+this.body.innerHTML;else for(h=o.document.createElement("p");e;){while(e&&(e.nodeType==3||e.nodeType==1&&u.p[e.tagName]&&!u.$cdata[e.tagName]))l=e.nextSibling,h.appendChild(e),e=l;if(h.firstChild)if(e)e.parentNode.insertBefore(h,e),h=o.document.createElement("p");else{o.body.appendChild(h);break}e=e.nextSibling}o.fireEvent("aftersetcontent");o.fireEvent("contentchange");f||o._selectionChange();o._bakRange=o._bakIERange=o._bakNativeRange=null;i.gecko&&(a=this.selection.getNative())&&a.removeAllRanges();o.options.autoSyncData&&o.form&&s(o.form,o)},focus:function(n){try{var t=this,i=t.selection.getRange();n?i.setStartAtLast(t.body.lastChild).setCursor(!1,!0):i.select(!0);this.fireEvent("focus")}catch(r){}},blur:function(){var n=this.selection.getNative();n.empty?n.empty():n.removeAllRanges();this.fireEvent("blur")},isFocus:function(){return this.fireEvent("isfocus")===!0?!0:this.selection.isFocus()},_initEvents:function(){var t=this,r=t.body,i=function(){t._proxyDomEvent.apply(t,arguments)};n(r).on("click contextmenu mousedown keydown keyup keypress mouseup mouseover mouseout selectstart",i).on("focus blur",i).on("mouseup keydown",function(n){n.type=="keydown"&&(n.ctrlKey||n.metaKey||n.shiftKey||n.altKey)||n.button!=2&&t._selectionChange(250,n)})},_proxyDomEvent:function(n){return this.fireEvent(n.type.replace(/^on/,""),n)},_selectionChange:function(n,t){var r=this,u=!1,f,e,o;i.ie&&i.version<9&&t&&t.type=="mouseup"&&(o=this.selection.getRange(),o.collapsed||(u=!0,f=t.clientX,e=t.clientY));clearTimeout(h);h=setTimeout(function(){var n,i;if(r.selection.getNative()){if(u&&r.selection.getNative().type=="None"){n=r.document.body.createTextRange();try{n.moveToPoint(f,e)}catch(o){n=null}}n&&(i=r.selection.getIERange,r.selection.getIERange=function(){return n});r.selection.cache();i&&(r.selection.getIERange=i);r.selection._cachedRange&&r.selection._cachedStartElement&&(r.fireEvent("beforeselectionchange"),r.fireEvent("selectionchange",!!t),r.fireEvent("afterselectionchange"),r.selection.clear())}},n||50)},_callCmdFn:function(n,t){t=Array.prototype.slice.call(t,0);var u=t.shift().toLowerCase(),i,r;if(i=this.commands[u]||UM.commands[u],r=i&&i[n],i&&r||n!="queryCommandState"){if(r)return r.apply(this,[u].concat(t))}else return 0},execCommand:function(n){var r,t,u,i;return(this.isFocus()||(r=this.selection._bakRange,r?r.select():this.focus(!0)),n=n.toLowerCase(),t=this,i=t.commands[n]||UM.commands[n],!i||!i.execCommand)?null:(i.notNeedUndo||t.__hasEnterExecCommand?(u=this._callCmdFn("execCommand",arguments),t.__hasEnterExecCommand||i.ignoreContentChange||t._ignoreContentChange||t.fireEvent("contentchange")):(t.__hasEnterExecCommand=!0,t.queryCommandState.apply(t,arguments)!=-1&&(t.fireEvent("saveScene"),t.fireEvent("beforeexeccommand",n),u=this._callCmdFn("execCommand",arguments),i.ignoreContentChange||t._ignoreContentChange||t.fireEvent("contentchange"),t.fireEvent("afterexeccommand",n),t.fireEvent("saveScene")),t.__hasEnterExecCommand=!1),t.__hasEnterExecCommand||i.ignoreContentChange||t._ignoreContentChange||t._selectionChange(),u)},queryCommandState:function(){try{return this._callCmdFn("queryCommandState",arguments)}catch(n){return 0}},queryCommandValue:function(){try{return this._callCmdFn("queryCommandValue",arguments)}catch(n){return null}},hasContents:function(n){var i,r,u,f,e;if(n)for(i=0;r=n[i++];)if(this.body.getElementsByTagName(r).length>0)return!0;if(!t.isEmptyBlock(this.body))return!0;for(n=["div"],i=0;r=n[i++];)for(u=t.getElementsByTagName(this.body,r),f=0;e=u[f++];)if(t.isCustomeNode(e))return!0;return!1},reset:function(){this.fireEvent("reset")},isEnabled:function(){return this._isEnabled!=!0},setEnabled:function(){var n=this,t;if(n.body.contentEditable=!0,n.lastBk){t=n.selection.getRange();try{t.moveToBookmark(n.lastBk);delete n.lastBk}catch(i){t.setStartAtFirst(n.body).collapse(!0)}t.select(!0)}n.bkqueryCommandState&&(n.queryCommandState=n.bkqueryCommandState,delete n.bkqueryCommandState);n._bkproxyDomEvent&&(n._proxyDomEvent=n._bkproxyDomEvent,delete n._bkproxyDomEvent);n.fireEvent("setEnabled")},enable:function(){return this.setEnabled()},setDisabled:function(n,t){var i=this;i.body.contentEditable=!1;i._except=n?r.isArray(n)?n:[n]:[];i.lastBk||(i.lastBk=i.selection.getRange().createBookmark(!0));i.bkqueryCommandState||(i.bkqueryCommandState=i.queryCommandState,i.queryCommandState=function(n){return r.indexOf(i._except,n)!=-1?i.bkqueryCommandState.apply(i,arguments):-1});t||i._bkproxyDomEvent||(i._bkproxyDomEvent=i._proxyDomEvent,i._proxyDomEvent=function(){return!1});i.fireEvent("selectionchange");i.fireEvent("setDisabled",i._except)},disable:function(n){return this.setDisabled(n)},_setDefaultContent:function(){function n(){var t=this;t.document.getElementById("initContent")&&(t.body.innerHTML="<p>"+(e?"":"<br/>")+"<\/p>",t.removeListener("firstBeforeExecCommand focus",n),setTimeout(function(){t.focus();t._selectionChange()},0))}return function(t){var i=this;i.body.innerHTML='<p id="initContent">'+t+"<\/p>";i.addListener("firstBeforeExecCommand focus",n)}}(),setShow:function(){var n=this,t=n.selection.getRange();if(n.container.style.display=="none"){try{t.moveToBookmark(n.lastBk);delete n.lastBk}catch(i){t.setStartAtFirst(n.body).collapse(!0)}setTimeout(function(){t.select(!0)},100);n.container.style.display=""}},show:function(){return this.setShow()},setHide:function(){var n=this;n.lastBk||(n.lastBk=n.selection.getRange().createBookmark(!0));n.container.style.display="none"},hide:function(){return this.setHide()},getLang:function(n){var t=UM.I18N[this.options.lang],i,r;if(!t)throw Error("not import language file");for(n=(n||"").split("."),i=0;r=n[i++];)if(t=t[r],!t)break;return t},getContentLength:function(n,t){var i=this.getContent(!1,!1,!0).length,r,u;if(n)for(t=(t||[]).concat(["hr","img","iframe"]),i=this.getContentTxt().replace(/[\t\r\n]+/g,"").length,r=0;u=t[r++];)i+=this.body.getElementsByTagName(u).length;return i},addInputRule:function(n,t){n.ignoreUndo=t;this.inputRules.push(n)},filterInputRule:function(n,t){for(var r=0,i;i=this.inputRules[r++];)t&&i.ignoreUndo||i.call(this,n)},addOutputRule:function(n,t){n.ignoreUndo=t;this.outputRules.push(n)},filterOutputRule:function(n,t){for(var r=0,i;i=this.outputRules[r++];)t&&i.ignoreUndo||i.call(this,n)}};r.inherits(l,o)}();v=UM.filterWord=function(){function t(n){return/(class="?Mso|style="[^"]*\bmso\-|w:WordDocument|<(v|o):|lang=)/ig.test(n)}function n(n){return n.replace(/[\d.]+\w+/g,function(n){return r.transUnitToPx(n)})}function u(t){return t.replace(/[\t\r\n]+/g," ").replace(/<!--[\s\S]*?-->/ig,"").replace(/<v:shape [^>]*>[\s\S]*?.<\/v:shape>/gi,function(t){if(i.opera)return"";try{if(/Bitmap/i.test(t))return"";var r=t.match(/width:([ \d.]*p[tx])/i)[1],u=t.match(/height:([ \d.]*p[tx])/i)[1],f=t.match(/src=\s*"([^"]*)"/i)[1];return'<img width="'+n(r)+'" height="'+n(u)+'" src="'+f+'" />'}catch(e){return""}}).replace(/<\/?div[^>]*>/g,"").replace(/v:\w+=(["']?)[^'"]+\1/g,"").replace(/<(!|script[^>]*>.*?<\/script(?=[>\s])|\/?(\?xml(:\w+)?|xml|meta|link|style|\w+:\w+)(?=[\s\/>]))[^>]*>/gi,"").replace(/<p [^>]*class="?MsoHeading"?[^>]*>(.*?)<\/p>/gi,"<p><strong>$1<\/strong><\/p>").replace(/\s+(class|lang|align)\s*=\s*(['"]?)([\w-]+)\2/ig,function(n,t,i,r){return t=="class"&&r=="MsoListParagraph"?n:""}).replace(/<(font|span)[^>]*>(\s*)<\/\1>/gi,function(n,t,i){return i.replace(/[\t\r\n ]+/g," ")}).replace(/(<[a-z][^>]*)\sstyle=(["'])([^\2]*?)\2/gi,function(t,i,r,u){for(var s,f,h,e=[],l=u.replace(/^\s+|\s+$/,"").replace(/&#39;/g,"'").replace(/&quot;/gi,"'").split(/;\s*/g),o=0,c;c=l[o];o++)if(h=c.split(":"),h.length==2){if(s=h[0].toLowerCase(),f=h[1].toLowerCase(),/^(background)\w*/.test(s)&&f.replace(/(initial|\s)/g,"").length==0||/^(margin)\w*/.test(s)&&/^0\w+$/.test(f))continue;switch(s){case"mso-padding-alt":case"mso-padding-top-alt":case"mso-padding-right-alt":case"mso-padding-bottom-alt":case"mso-padding-left-alt":case"mso-margin-alt":case"mso-margin-top-alt":case"mso-margin-right-alt":case"mso-margin-bottom-alt":case"mso-margin-left-alt":case"mso-height":case"mso-width":case"mso-vertical-align-alt":/<table/.test(i)||(e[o]=s.replace(/^mso-|-alt$/g,"")+":"+n(f));continue;case"horiz-align":e[o]="text-align:"+f;continue;case"vert-align":e[o]="vertical-align:"+f;continue;case"font-color":case"mso-foreground":e[o]="color:"+f;continue;case"mso-background":case"mso-highlight":e[o]="background:"+f;continue;case"mso-default-height":e[o]="min-height:"+n(f);continue;case"mso-default-width":e[o]="min-width:"+n(f);continue;case"mso-padding-between-alt":e[o]="border-collapse:separate;border-spacing:"+n(f);continue;case"text-line-through":(f=="single"||f=="double")&&(e[o]="text-decoration:line-through");continue;case"mso-zero-height":f=="yes"&&(e[o]="display:none");continue;case"margin":if(!/[1-9]/.test(f))continue}if(/^(mso|column|font-emph|lang|layout|line-break|list-image|nav|panose|punct|row|ruby|sep|size|src|tab-|table-border|text-(?:decor|trans)|top-bar|version|vnd|word-break)/.test(s)||/text\-indent|padding|margin/.test(s)&&/\-[\d.]+/.test(f))continue;e[o]=s+":"+h[1]}return i+(e.length?' style="'+e.join(";").replace(/;{2,}/g,";")+'"':"")}).replace(/[\d.]+(cm|pt)/g,function(n){return r.transUnitToPx(n)})}return function(n){return t(n)?u(n):n}}(),function(){function i(n,t,i){return n.push(v),t+(i?1:-1)}function f(n,t){for(var i=0;i<t;i++)n.push(a)}function e(n,t,r,o){switch(n.type){case"root":for(var h=0,s;s=n.children[h++];)r&&s.type=="element"&&!u.$inlineWithA[s.tagName]&&h>1&&(i(t,o,!0),f(t,o)),e(s,t,r,o);break;case"text":y(n,t);break;case"element":p(n,t,r,o);break;case"comment":w(n,t,r)}return t}function y(n,t){n.parentNode.tagName=="pre"?t.push(n.data):t.push(l[n.parentNode.tagName]?r.html(n.data):n.data.replace(/[ ]{2}/g," &nbsp;"))}function p(n,t,o,s){var h="",a,l,y,v;if(n.attrs){h=[];a=n.attrs;for(l in a)h.push(l+(a[l]!==undefined?'="'+(c[l]?r.html(a[l]).replace(/["]/g,function(){return"&quot;"}):r.unhtml(a[l]))+'"':""));h=h.join(" ")}if(t.push("<"+n.tagName+(h?" "+h:"")+(u.$empty[n.tagName]?"/":"")+">"),o&&!u.$inlineWithA[n.tagName]&&n.tagName!="pre"&&n.children&&n.children.length&&(s=i(t,s,!0),f(t,s)),n.children&&n.children.length)for(y=0;v=n.children[y++];)o&&v.type=="element"&&!u.$inlineWithA[v.tagName]&&y>1&&(i(t,s),f(t,s)),e(v,t,o,s);u.$empty[n.tagName]||(o&&!u.$inlineWithA[n.tagName]&&n.tagName!="pre"&&n.children&&n.children.length&&(s=i(t,s),f(t,s)),t.push("<\/"+n.tagName+">"))}function w(n,t){t.push("<!--"+n.data+"-->")}function o(n,t){var i,r,u;if(n.type=="element"&&n.getAttr("id")==t)return n;if(n.children&&n.children.length)for(r=0;u=n.children[r++];)if(i=o(u,t))return i}function s(n,t,i){if(n.type=="element"&&n.tagName==t&&i.push(n),n.children&&n.children.length)for(var u=0,r;r=n.children[u++];)s(r,t,i)}function h(n,t){if(n.children&&n.children.length)for(var r=0,i;i=n.children[r];)h(i,t),i.parentNode&&(i.children&&i.children.length&&t(i),i.parentNode&&r++);else t(n)}var t=UM.uNode=function(n){this.type=n.type;this.data=n.data;this.tagName=n.tagName;this.parentNode=n.parentNode;this.attrs=n.attrs||{};this.children=n.children},c={href:1,src:1,_src:1,_href:1,cdata_data:1},l={style:1,script:1},a="    ",v="\n";t.createElement=function(n){return/[<>]/.test(n)?UM.htmlparser(n).children[0]:new t({type:"element",children:[],tagName:n})};t.createText=function(n,t){return new UM.uNode({type:"text",data:t?n:r.unhtml(n||"")})};t.prototype={toHtml:function(n){var t=[];return e(this,t,n,0),t.join("")},innerHTML:function(n){var i,t,f;if(this.type!="element"||u.$empty[this.tagName])return this;if(r.isString(n)){if(this.children)for(i=0;t=this.children[i++];)t.parentNode=null;for(this.children=[],f=UM.htmlparser(n),i=0;t=f.children[i++];)this.children.push(t),t.parentNode=this;return this}return f=new UM.uNode({type:"root",children:this.children}),f.toHtml()},innerText:function(n,i){if(this.type!="element"||u.$empty[this.tagName])return this;if(n){if(this.children)for(var f=0,r;r=this.children[f++];)r.parentNode=null;return this.children=[],this.appendChild(t.createText(n,i)),this}return this.toHtml().replace(/<[^>]+>/g,"")},getData:function(){return this.type=="element"?"":this.data},firstChild:function(){return this.children?this.children[0]:null},lastChild:function(){return this.children?this.children[this.children.length-1]:null},previousSibling:function(){for(var t=this.parentNode,n=0,i;i=t.children[n];n++)if(i===this)return n==0?null:t.children[n-1]},nextSibling:function(){for(var n=this.parentNode,t=0,i;i=n.children[t++];)if(i===this)return n.children[t]},replaceChild:function(n,t){if(this.children){n.parentNode&&n.parentNode.removeChild(n);for(var i=0,r;r=this.children[i];i++)if(r===t)return this.children.splice(i,1,n),t.parentNode=null,n.parentNode=this,n}},appendChild:function(n){if(this.type=="root"||this.type=="element"&&!u.$empty[this.tagName]){this.children||(this.children=[]);n.parentNode&&n.parentNode.removeChild(n);for(var t=0,i;i=this.children[t];t++)if(i===n){this.children.splice(t,1);break}return this.children.push(n),n.parentNode=this,n}},insertBefore:function(n,t){if(this.children){n.parentNode&&n.parentNode.removeChild(n);for(var i=0,r;r=this.children[i];i++)if(r===t)return this.children.splice(i,0,n),n.parentNode=this,n}},insertAfter:function(n,t){if(this.children){n.parentNode&&n.parentNode.removeChild(n);for(var i=0,r;r=this.children[i];i++)if(r===t)return this.children.splice(i+1,0,n),n.parentNode=this,n}},removeChild:function(n,t){var r,i,u,f;if(this.children)for(r=0;i=this.children[r];r++)if(i===n){if(this.children.splice(r,1),i.parentNode=null,t&&i.children&&i.children.length)for(u=0;f=i.children[u];u++)this.children.splice(r+u,0,f),f.parentNode=this;return i}},getAttr:function(n){return this.attrs&&this.attrs[n.toLowerCase()]},setAttr:function(n,t){if(!n){delete this.attrs;return}if(this.attrs||(this.attrs={}),r.isObject(n))for(var i in n)n[i]?this.attrs[i.toLowerCase()]=n[i]:delete this.attrs[i];else t?this.attrs[n.toLowerCase()]=t:delete this.attrs[n]},hasAttr:function(n){var t=this.getAttr(n);return t!==null&&t!==undefined},getIndex:function(){for(var i=this.parentNode,n=0,t;t=i.children[n];n++)if(t===this)return n;return-1},getNodeById:function(n){var t,i,r;if(this.children&&this.children.length)for(i=0;r=this.children[i++];)if(t=o(r,n))return t},getNodesByTagName:function(n){n=r.trim(n).replace(/[ ]{2,}/g," ").split(" ");var i=[],t=this;return r.each(n,function(n){if(t.children&&t.children.length)for(var u=0,r;r=t.children[u++];)s(r,n,i)}),i},getStyle:function(n){var i=this.getAttr("style"),r,t;return i?(r=new RegExp("(^|;)\\s*"+n+":([^;]+)","i"),t=i.match(r),t&&t[0])?t[2]:"":""},setStyle:function(n,t){function f(n,t){var u=new RegExp("(^|;)\\s*"+n+":([^;]+;?)","gi");i=i.replace(u,"$1");t&&(i=n+":"+r.unhtml(t)+";"+i)}var i=this.getAttr("style"),u;if(i||(i=""),r.isObject(n))for(u in n)f(u,n[u]);else f(n,t);this.setAttr("style",r.trim(i))},hasClass:function(t){if(this.hasAttr("class")){var r=this.getAttr("class").split(/\s+/),i=!1;return n.each(r,function(n,r){r===t&&(i=!0)}),i}return!1},addClass:function(n){var t=null,i=!1;this.hasAttr("class")?(t=this.getAttr("class"),t=t.split(/\s+/),t.forEach(function(t){if(t===n){i=!0;return}}),i||t.push(n),this.setAttr("class",t.join(" "))):this.setAttr("class",n)},removeClass:function(n){if(this.hasAttr("class")){var t=this.getAttr("class");t=t.replace(new RegExp("\\b"+n+"\\b","g"),"");this.setAttr("class",r.trim(t).replace(/[ ]{2,}/g," "))}},traversal:function(n){return this.children&&this.children.length&&h(this,n),this}}}();y=UM.htmlparser=function(n,i){function h(n,t){if(a[n.tagName]){var i=o.createElement(a[n.tagName]);n.appendChild(i);i.appendChild(o.createText(t));n=i}else n.appendChild(o.createText(t))}function v(n,t,i){var e,s,l,h,c,f;if(e=d[t]){for(s=n;s.type!="root";){if(r.isArray(e)?r.indexOf(e,s.tagName)!=-1:e==s.tagName){n=s;l=!0;break}s=s.parentNode}l||(n=v(n,r.isArray(e)?e[0]:e))}if(h=new o({parentNode:n,type:"element",tagName:t.toLowerCase(),children:u.$empty[t]?null:[]}),i){for(c={};f=w.exec(i);)c[f[1].toLowerCase()]=k[f[1].toLowerCase()]?f[2]||f[3]||f[4]:r.unhtml(f[2]||f[3]||f[4]);h.attrs=c}return n.children.push(h),u.$empty[t]?n:h}function g(n,t){n.children.push(new o({type:"comment",data:t,parentNode:n}))}var l=/<(?:(?:\/([^>]+)>)|(?:!--([\S|\s]*?)-->)|(?:([^\s\/>]+)\s*((?:(?:"[^"]*")|(?:'[^']*')|[^"'<>])*)\/?>))/g,w=/([\w\-:.]+)(?:(?:\s*=\s*(?:(?:"([^"]*)")|(?:'([^']*)')|([^\s>]+)))|(?=\s|$))/g,b={b:1,code:1,i:1,u:1,strike:1,s:1,tt:1,strong:1,q:1,samp:1,em:1,span:1,sub:1,img:1,sup:1,font:1,big:1,small:1,iframe:1,a:1,br:1,pre:1},p;n=n.replace(new RegExp(t.fillChar,"g"),"");i||(n=n.replace(new RegExp("[\\r\\t\\n"+(i?"":" ")+"]*<\/?(\\w+)\\s*(?:[^>]*)>[\\r\\t\\n"+(i?"":" ")+"]*","g"),function(n,t){return t&&b[t.toLowerCase()]?n.replace(/(^[\n\r]+)|([\n\r]+$)/g,""):n.replace(new RegExp("^[\\r\\n"+(i?"":" ")+"]+"),"").replace(new RegExp("[\\r\\n"+(i?"":" ")+"]+$"),"")}));for(var k={href:1,src:1},o=UM.uNode,d={td:"tr",tr:["tbody","thead","tfoot"],tbody:"table",th:"tr",thead:"table",tfoot:"table",caption:"table",li:["ul","ol"],dt:"dl",dd:"dl",option:"select"},a={ol:"li",ul:"li"},e,c=0,s=0,y=new o({type:"root",children:[]}),f=y;e=l.exec(n);){c=e.index;try{if(c>s&&h(f,n.slice(s,c)),e[3])u.$cdata[f.tagName]?h(f,e[0]):f=v(f,e[3].toLowerCase(),e[4]);else if(e[1]){if(f.type!="root")if(u.$cdata[f.tagName]&&!u.$cdata[e[1]])h(f,e[0]);else{for(p=f;f.type=="element"&&f.tagName!=e[1].toLowerCase();)if(f=f.parentNode,f.type=="root"){f=p;throw"break";}f=f.parentNode}}else e[2]&&g(f,e[2])}catch(nt){}s=l.lastIndex}return s<n.length&&h(f,n.slice(s)),y};p=UM.filterNode=function(){function n(t,i){var s,h,v,a,o,y,c,l,f,e;switch(t.type){case"element":if(s=i[t.tagName])if(s==="-")t.parentNode.removeChild(t);else if(r.isFunction(s))if(c=t.parentNode,l=t.getIndex(),s(t),t.parentNode){if(t.children)for(f=0;e=t.children[f];)n(e,i),e.parentNode&&f++}else for(f=l;e=c.children[f];)n(e,i),e.parentNode&&f++;else{if(h=s.$,h&&t.attrs){v={};for(o in h)a=t.getAttr(o),o=="style"&&r.isArray(h[o])&&(y=[],r.each(h[o],function(n){var i;(i=t.getStyle(n))&&y.push(n+":"+i)}),a=y.join(";")),a&&(v[o]=a);t.attrs=v}if(t.children)for(f=0;e=t.children[f];)n(e,i),e.parentNode&&f++}else if(u.$cdata[t.tagName])t.parentNode.removeChild(t);else for(c=t.parentNode,l=t.getIndex(),t.parentNode.removeChild(t,!0),f=l;e=c.children[f];)n(e,i),e.parentNode&&f++;break;case"comment":t.parentNode.removeChild(t)}}return function(t,i){var e,u,f;if(r.isEmptyObject(i))return t;for((e=i["-"])&&r.each(e.split(" "),function(n){i[n]="-"}),u=0;f=t.children[u];)n(f,i),f.parentNode&&u++;return t}}();UM.commands.inserthtml={execCommand:function(n,f,e){var a=this,o,b,k,c,h,p,w,d,v,g,y,tt,l,nt;if(f&&a.fireEvent("beforeinserthtml",f)!==!0){if(o=a.selection.getRange(),b=o.document.createElement("div"),b.style.display="inline",e||(k=UM.htmlparser(f),a.options.filterRules&&UM.filterNode(k,a.options.filterRules),a.filterInputRule(k),f=k.toHtml()),b.innerHTML=r.trim(f),!o.collapsed&&(c=o.startContainer,t.isFillChar(c)&&o.setStartBefore(c),c=o.endContainer,t.isFillChar(c)&&o.setEndAfter(c),o.txtToElmBoundary(),o.endContainer&&o.endContainer.nodeType==1&&(c=o.endContainer.childNodes[o.endOffset],c&&t.isBr(c)&&o.setEndAfter(c)),o.startOffset==0&&(c=o.startContainer,t.isBoundaryNode(c,"firstChild")&&(c=o.endContainer,o.endOffset==(c.nodeType==3?c.nodeValue.length:c.childNodes.length)&&t.isBoundaryNode(c,"lastChild")&&(a.body.innerHTML="<p>"+(i.ie?"":"<br/>")+"<\/p>",o.setStart(a.body.firstChild,0).collapse(!0)))),o.collapsed||o.deleteContents(),o.startContainer.nodeType==1&&(h=o.startContainer.childNodes[o.startOffset],h&&t.isBlockElm(h)&&(l=h.previousSibling)&&t.isBlockElm(l)))){for(o.setEnd(l,l.childNodes.length).collapse();h.firstChild;)l.appendChild(h.firstChild);t.remove(h)}for(d=0,o.inFillChar()&&(h=o.startContainer,t.isFillChar(h)?(o.setStartBefore(h).collapse(!0),t.remove(h)):t.isFillChar(h,!0)&&(h.nodeValue=h.nodeValue.replace(s,""),o.startOffset--,o.collapsed&&o.collapse(!0)));h=b.firstChild;){if(d){for(g=a.document.createElement("p");h&&(h.nodeType==3||!u.$block[h.tagName]);)v=h.nextSibling,g.appendChild(h),h=v;g.firstChild&&(h=g)}if(o.insertNode(h),v=h.nextSibling,!d&&h.nodeType==t.NODE_ELEMENT&&t.isBlockElm(h)&&(p=t.findParent(h,function(n){return t.isBlockElm(n)}),p&&p.tagName.toLowerCase()!="body"&&!(u[p.tagName][h.nodeName]&&h.parentNode===p))){if(u[p.tagName][h.nodeName])for(w=h.parentNode;w!==p;)l=w,w=w.parentNode;else l=p;t.breakParent(h,l||w);l=h.previousSibling;t.trimWhiteTextNode(l);l.childNodes.length||t.remove(l);!i.ie&&(y=h.nextSibling)&&t.isBlockElm(y)&&y.lastChild&&!t.isBr(y.lastChild)&&y.appendChild(a.document.createElement("br"));d=1}if(y=h.nextSibling,!b.firstChild&&y&&t.isBlockElm(y)){o.setStart(y,0).collapse(!0);break}o.setEndAfter(h).collapse()}if(h=o.startContainer,v&&t.isBr(v)&&t.remove(v),t.isBlockElm(h)&&t.isEmptyNode(h))if(v=h.nextSibling)t.remove(h),v.nodeType==1&&u.$block[v.tagName]&&o.setStart(v,0).collapse(!0).shrinkBoundary();else try{h.innerHTML=i.ie?t.fillChar:"<br/>"}catch(it){o.setStartBefore(h);t.remove(h)}try{i.ie9below&&o.startContainer.nodeType==1&&!o.startContainer.childNodes[o.startOffset]&&(tt=o.startContainer,l=tt.childNodes[o.startOffset-1],l&&l.nodeType==1&&u.$empty[l.tagName]&&(nt=this.document.createTextNode(t.fillChar),o.insertNode(nt).setStart(nt,0).collapse(!0)));setTimeout(function(){o.select(!0)})}catch(it){}setTimeout(function(){o=a.selection.getRange();o.scrollIntoView();a.fireEvent("afterinserthtml")},200)}}};UM.commands.insertimage={execCommand:function(n,t){var e;if(t=r.isArray(t)?t:[t],t.length){var o=this,f=[],u="",i;if(i=t[0],t.length==1)u='<img src="'+i.src+'" '+(i._src?' _src="'+i._src+'" ':"")+(i.width?'width="'+i.width+'" ':"")+(i.height?' height="'+i.height+'" ':"")+(i.floatStyle=="left"||i.floatStyle=="right"?' style="float:'+i.floatStyle+';"':"")+(i.title&&i.title!=""?' title="'+i.title+'"':"")+(i.border&&i.border!="0"?' border="'+i.border+'"':"")+(i.alt&&i.alt!=""?' alt="'+i.alt+'"':"")+(i.hspace&&i.hspace!="0"?' hspace = "'+i.hspace+'"':"")+(i.vspace&&i.vspace!="0"?' vspace = "'+i.vspace+'"':"")+"/>",i.floatStyle=="center"&&(u='<p style="text-align: center">'+u+"<\/p>"),f.push(u);else for(e=0;i=t[e++];)u="<p "+(i.floatStyle=="center"?'style="text-align: center" ':"")+'><img src="'+i.src+'" '+(i.width?'width="'+i.width+'" ':"")+(i._src?' _src="'+i._src+'" ':"")+(i.height?' height="'+i.height+'" ':"")+' style="'+(i.floatStyle&&i.floatStyle!="center"?"float:"+i.floatStyle+";":"")+(i.border||"")+'" '+(i.title?' title="'+i.title+'"':"")+" /><\/p>",f.push(u);o.execCommand("insertHtml",f.join(""),!0)}}};UM.plugins.justify=function(){var t=this;n.each("justifyleft justifyright justifycenter justifyfull".split(" "),function(n,i){t.commands[i]={execCommand:function(n){return this.document.execCommand(n)},queryCommandValue:function(n){var t=this.document.queryCommandValue(n);return t===!0||t==="true"?n.replace(/justify/,""):""},queryCommandState:function(n){return this.document.queryCommandState(n)?1:0}}})};UM.plugins.font=function(){var t=this,u={forecolor:"forecolor",backcolor:"backcolor",fontsize:"fontsize",fontfamily:"fontname"},f={forecolor:"color",backcolor:"background-color",fontsize:"font-size",fontfamily:"font-family"},o={forecolor:"color",fontsize:"size",fontfamily:"face"},e;t.setOpt({fontfamily:[{name:"songti",val:"宋体,SimSun"},{name:"yahei",val:"微软雅黑,Microsoft YaHei"},{name:"kaiti",val:"楷体,楷体_GB2312, SimKai"},{name:"heiti",val:"黑体, SimHei"},{name:"lishu",val:"隶书, SimLi"},{name:"andaleMono",val:"andale mono"},{name:"arial",val:"arial, helvetica,sans-serif"},{name:"arialBlack",val:"arial black,avant garde"},{name:"comicSansMs",val:"comic sans ms"},{name:"impact",val:"impact,chicago"},{name:"timesNewRoman",val:"times new roman"},{name:"sans-serif",val:"sans-serif"}],fontsize:[10,12,16,18,24,32,48]});t.addOutputRule(function(t){r.each(t.getNodesByTagName("font"),function(t){var i,r,u;if(t.tagName=="font"){i=[];for(r in t.attrs)switch(r){case"size":u=t.attrs[r];n.each({"10":"1","12":"2","16":"3","18":"4","24":"5","32":"6","48":"7"},function(n,t){if(t==u)return u=n,!1});i.push("font-size:"+u+"px");break;case"color":i.push("color:"+t.attrs[r]);break;case"face":i.push("font-family:"+t.attrs[r]);break;case"style":i.push(t.attrs[r])}t.attrs={style:i.join(";")}}t.tagName="span";t.parentNode.tagName=="span"&&t.parentNode.children.length==1&&(n.each(t.attrs,function(n,i){t.parentNode.attrs[n]=n=="style"?t.parentNode.attrs[n]+i:i}),t.parentNode.removeChild(t,!0))})});for(e in u)(function(e){t.commands[e]={execCommand:function(t,r){var e,o;if(r!="transparent")if(e=this.selection.getRange(),e.collapsed)o=n("<span><\/span>").css(f[t],r)[0],e.insertNode(o).setStart(o,0).setCursor();else{if(t=="fontsize"&&(r={"10":"1","12":"2","16":"3","18":"4","24":"5","32":"6","48":"7"}[(r+"").replace(/px/,"")]),this.document.execCommand(u[t],!1,r),i.gecko&&n.each(this.$body.find("a"),function(t,i){var r=i.parentNode,u;r.lastChild===r.firstChild&&/FONT|SPAN/.test(r.tagName)&&(u=r.cloneNode(!1),u.innerHTML=i.innerHTML,n(i).html("").append(u).insertBefore(r),n(r).remove())}),!i.ie){var s=this.selection.getNative().getRangeAt(0),h=s.commonAncestorContainer,e=this.selection.getRange(),c=e.createBookmark(!0);n(h).find("a").each(function(t,i){var u=i.parentNode,r;u.nodeName=="FONT"&&(r=u.cloneNode(!1),r.innerHTML=i.innerHTML,n(i).html("").append(r))});e.moveToBookmark(c).select()}return!0}},queryCommandValue:function(i){var e=t.selection.getStart(),u=n(e).css(f[i]);return u===undefined&&(u=n(e).attr(o[i])),u?r.fixColor(i,u).replace(/px/,""):""},queryCommandState:function(n){return this.queryCommandValue(n)}}})(e)};UM.plugins.link=function(){var u=this;u.setOpt("autourldetectinie",!1);i.ie&&this.options.autourldetectinie===!1&&this.addListener("keyup",function(n,i){var o=this,f=i.keyCode,e,r,u;(f==13||f==32)&&(e=o.selection.getRange(),r=e.startContainer,f==13?r.nodeName=="P"&&(u=r.previousSibling,u&&u.nodeType==1&&(u=u.lastChild,u&&u.nodeName=="A"&&!u.getAttribute("_href")&&t.remove(u,!0))):f==32&&r.nodeType==3&&/^\s$/.test(r.nodeValue)&&(r=r.previousSibling,r&&r.nodeName=="A"&&!r.getAttribute("_href")&&t.remove(r,!0)))});this.addOutputRule(function(t){n.each(t.getNodesByTagName("a"),function(n,t){var i=r.html(t.getAttr("_href"));/^(ftp|https?|\/|file)/.test(i)||(i="http://"+i);t.setAttr("href",i);t.setAttr("_href");t.getAttr("title")==""&&t.setAttr("title")})});this.addInputRule(function(t){n.each(t.getNodesByTagName("a"),function(n,t){t.setAttr("_href",r.html(t.getAttr("href")))})});u.commands.link={execCommand:function(i,u){var o=this,f=o.selection.getRange(),e;f.collapsed?(e=f.startContainer,(e=t.findParentByTagName(e,"a",!0))?(n(e).attr(u),f.selectNode(e).select()):f.insertNode(n("<a>"+u.href+"<\/a>").attr(u)[0]).select()):(o.document.execCommand("createlink",!1,"_umeditor_link"),r.each(t.getElementsByTagName(o.body,"a",function(n){return n.getAttribute("href")=="_umeditor_link"}),function(i){n(i).text()=="_umeditor_link"&&n(i).text(u.href);t.setAttributes(i,u);f.selectNode(i).select()}))},queryCommandState:function(){return this.queryCommandValue("link")?1:0},queryCommandValue:function(){var i=this.selection.getStartElementPath(),t;return n.each(i,function(n,i){if(i.nodeName=="A")return t=i,!1}),t}};u.commands.unlink={execCommand:function(){this.document.execCommand("unlink")}}};UM.commands.print={execCommand:function(){var u=this,t="editor_print_"+ +new Date,r,i;n('<iframe src="" id="'+t+'" name="'+t+'" frameborder="0"><\/iframe>').attr("id",t).css({width:"0px",height:"0px",overflow:"hidden",float:"left",position:"absolute",top:"-10000px",left:"-10000px"}).appendTo(u.$container.find(".edui-dialog-container"));r=window.open("",t,"");i=r.document;i.open();i.write("<html><head><\/head><body><div>"+this.getContent(null,null,!0)+"<\/div><script>setTimeout(function(){window.print();setTimeout(function(){window.parent.$('#"+t+"').remove();},100);},200);<\/script><\/body><\/html>");i.close()},notNeedUndo:1};UM.plugins.paragraph=function(){var n=this;n.setOpt("paragraph",{p:"",h1:"",h2:"",h3:"",h4:"",h5:"",h6:""});n.commands.paragraph={execCommand:function(n,t){return this.document.execCommand("formatBlock",!1,"<"+t+">")},queryCommandValue:function(){try{var n=this.document.queryCommandValue("formatBlock")}catch(t){}return n}}};UM.plugins.horizontal=function(){var r=this;r.commands.horizontal={execCommand:function(){var e,f,s,h,o,c;if(this.document.execCommand("insertHorizontalRule"),e=r.selection.getRange().txtToElmBoundary(!0),f=e.startContainer,t.isBody(e.startContainer))s=e.startContainer.childNodes[e.startOffset],s||(s=n("<p><\/p>").appendTo(e.startContainer).html(i.ie?"&nbsp;":"<br/>")[0]),e.setStart(s,0).setCursor();else{while(u.$inline[f.tagName]&&f.lastChild===f.firstChild)h=f.parentNode,h.appendChild(f.firstChild),h.removeChild(f),f=h;while(u.$inline[f.tagName])f=f.parentNode;f.childNodes.length==1&&f.lastChild.nodeName=="HR"?(o=f.lastChild,n(o).insertBefore(f),e.setStart(f,0).setCursor()):(o=n("hr",f)[0],t.breakParent(o,f),c=o.previousSibling,c&&t.isEmptyBlock(c)&&n(c).remove(),e.setStart(o.nextSibling,0).setCursor())}}}};UM.commands.cleardoc={execCommand:function(){var n=this,t=n.selection.getRange();n.body.innerHTML="<p>"+(e?"":"<br/>")+"<\/p>";t.setStart(n.body.firstChild,0).setCursor(!1,!0);setTimeout(function(){n.fireEvent("clearDoc")},0)}};UM.plugins.undo=function(){function a(n,t){if(n.length!=t.length)return 0;for(var i=0,r=n.length;i<r;i++)if(n[i]!=t[i])return 0;return 1}function g(n,t){return n.collapsed!=t.collapsed?0:!a(n.startAddress,t.startAddress)||!a(n.endAddress,t.endAddress)?0:1}function nt(){this.list=[];this.index=0;this.hasUndo=!1;this.hasRedo=!1;this.undo=function(){if(this.hasUndo){if(!this.list[this.index-1]&&this.list.length==1){this.reset();return}while(this.list[this.index].content==this.list[this.index-1].content)if(this.index--,this.index==0)return this.restore(0);this.restore(--this.index)}};this.redo=function(){if(this.hasRedo){while(this.list[this.index].content==this.list[this.index+1].content)if(this.index++,this.index==this.list.length-1)return this.restore(this.index);this.restore(++this.index)}};this.restore=function(){var n=this.editor,s=this.list[this.index],h=UM.htmlparser(s.content.replace(k,"")),e,o;n.options.autoClearEmptyNode=!1;n.filterInputRule(h,!0);n.options.autoClearEmptyNode=l;n.body.innerHTML=h.toHtml();n.fireEvent("afterscencerestore");i.ie&&r.each(t.getElementsByTagName(n.document,"td th caption p"),function(i){t.isEmptyNode(i)&&t.fillNode(n.document,i)});try{e=new f.Range(n.document,n.body).moveToAddress(s.address);i.ie&&e.collapsed&&e.startContainer.nodeType==1&&(o=e.startContainer.childNodes[e.startOffset],(!o||o.nodeType==1&&u.$empty[o])&&e.insertNode(n.document.createTextNode(" ")).collapse(!0));e.select(d[e.startContainer.nodeName.toLowerCase()])}catch(c){}this.update();this.clearKey();n.fireEvent("reset",!0)};this.getScene=function(){var n=this.editor,u=n.selection.getRange(),f=u.createAddress(!1,!0),r,t;return n.fireEvent("beforegetscene"),r=UM.htmlparser(n.body.innerHTML,!0),n.options.autoClearEmptyNode=!1,n.filterOutputRule(r,!0),n.options.autoClearEmptyNode=l,t=r.toHtml(),i.ie&&(t=t.replace(/>&nbsp;</g,"><").replace(/\s*</g,"<").replace(/>\s*/g,">")),n.fireEvent("aftergetscene"),{address:f,content:t}};this.save=function(n,t){clearTimeout(h);var i=this.getScene(t),r=this.list[this.index];r&&r.content==i.content&&(n?1:g(r.address,i.address))||(this.list=this.list.slice(0,this.index+1),this.list.push(i),this.list.length>w&&this.list.shift(),this.index=this.list.length-1,this.clearKey(),this.update())};this.update=function(){this.hasRedo=!!this.list[this.index+1];this.hasUndo=!!this.list[this.index-1]};this.reset=function(){this.list=[];this.index=0;this.hasUndo=!1;this.hasRedo=!1;this.clearKey()};this.clearKey=function(){c=0;p=null}}function v(){this.undoManger.save()}var h,e=this,w=e.options.maxUndoCount||20,b=e.options.maxInputCount||20,k=new RegExp(t.fillChar+"|<\/hr>","gi"),d={ol:1,ul:1,table:1,tbody:1,tr:1,body:1},l=e.options.autoClearEmptyNode,s;e.undoManger=new nt;e.undoManger.editor=e;e.addListener("saveScene",function(){var n=Array.prototype.splice.call(arguments,1);this.undoManger.save.apply(this.undoManger,n)});e.addListener("beforeexeccommand",v);e.addListener("afterexeccommand",v);e.addListener("reset",function(n,t){t||this.undoManger.reset()});e.commands.redo=e.commands.undo={execCommand:function(n){this.undoManger[n]()},queryCommandState:function(n){return this.undoManger["has"+(n.toLowerCase()=="undo"?"Undo":"Redo")]?0:-1},notNeedUndo:1};var y={16:1,17:1,18:1,37:1,38:1,39:1,40:1},c=0,p,o=!1;e.addListener("ready",function(){n(this.body).on("compositionstart",function(){o=!0}).on("compositionend",function(){o=!1})});e.addshortcutkey({Undo:"ctrl+90",Redo:"ctrl+89,shift+ctrl+z"});s=!0;e.addListener("keydown",function(n,t){var i=this,u=t.keyCode||t.which;if(!y[u]&&!t.ctrlKey&&!t.metaKey&&!t.shiftKey&&!t.altKey){if(o)return;if(!i.selection.getRange().collapsed){i.undoManger.save(!1,!0);s=!1;return}i.undoManger.list.length==0&&i.undoManger.save(!0);clearTimeout(h);function r(n){n.selection.getRange().collapsed&&n.fireEvent("contentchange");n.undoManger.save(!1,!0);n.fireEvent("selectionchange")}h=setTimeout(function(){if(o){var n=setInterval(function(){o||(r(i),clearInterval(n))},300);return}r(i)},200);p=u;c++;c>=b&&r(i)}});e.addListener("keyup",function(n,t){var i=t.keyCode||t.which;if(!y[i]&&!t.ctrlKey&&!t.metaKey&&!t.shiftKey&&!t.altKey){if(o)return;s||(this.undoManger.save(!1,!0),s=!0)}})};UM.plugins.paste=function(){function f(r){var f=this.document;if(!f.getElementById("baidu_pastebin")){var e=this.selection.getRange(),o=e.createBookmark(),u=f.createElement("div");u.id="baidu_pastebin";i.webkit&&u.appendChild(f.createTextNode(t.fillChar+t.fillChar));this.body.appendChild(u);o.start.style.display="";u.style.cssText="position:absolute;width:1px;height:1px;overflow:hidden;left:-1000px;white-space:nowrap;top:"+n(o.start).position().top+"px";e.selectNodeContents(u).select(!0);setTimeout(function(){if(i.webkit)for(var s=0,h=f.querySelectorAll("#baidu_pastebin"),n;n=h[s++];)if(t.isEmptyNode(n))t.remove(n);else{u=n;break}try{u.parentNode.removeChild(u)}catch(c){}e.moveToBookmark(o).select(!0);r(u)},0)}}function e(n){var e,p,a,w,c,b,h,y,k,v,d,g,f,o,s,l;if(n.firstChild){for(p=t.getElementsByTagName(n,"span"),f=0;a=p[f++];)(a.id=="_baidu_cut_start"||a.id=="_baidu_cut_end")&&t.remove(a);if(i.webkit){for(v=n.querySelectorAll("div br"),f=0;w=v[f++];)c=w.parentNode,c.tagName=="DIV"&&c.childNodes.length==1&&(c.innerHTML="<p><br/><\/p>",t.remove(c));for(b=n.querySelectorAll("#baidu_pastebin"),f=0;h=b[f++];){for(y=u.document.createElement("p"),h.parentNode.insertBefore(y,h);h.firstChild;)y.appendChild(h.firstChild);t.remove(h)}for(k=n.querySelectorAll("meta"),f=0;o=k[f++];)t.remove(o);for(v=n.querySelectorAll("br"),f=0;o=v[f++];)/^apple-/i.test(o.className)&&t.remove(o)}if(i.gecko)for(d=n.querySelectorAll("[_moz_dirty]"),f=0;o=d[f++];)o.removeAttribute("_moz_dirty");if(!i.ie)for(g=n.querySelectorAll("span.Apple-style-span"),f=0;o=g[f++];)t.remove(o,!0);if(e=n.innerHTML,e=UM.filterWord(e),s=UM.htmlparser(e),u.options.filterRules&&UM.filterNode(s,u.options.filterRules),u.filterInputRule(s),i.webkit&&(l=s.lastChild(),l&&l.type=="element"&&l.tagName=="br"&&s.removeChild(l),r.each(u.body.querySelectorAll("div"),function(n){t.isEmptyBlock(n)&&t.remove(n)})),e={html:s.toHtml()},u.fireEvent("beforepaste",e,s),!e.html)return;u.execCommand("insertHtml",e.html,!0);u.fireEvent("afterpaste",e)}}var u=this;u.addListener("ready",function(){n(u.body).on("cut",function(){var n=u.selection.getRange();!n.collapsed&&u.undoManger&&u.undoManger.save()}).on(i.ie||i.opera?"keydown":"paste",function(n){(i.ie||i.opera)&&(!n.ctrlKey&&!n.metaKey||n.keyCode!="86")||f.call(u,function(n){e(n)})})})};UM.plugins.list=function(){var i=this;i.setOpt({insertorderedlist:{decimal:"","lower-alpha":"","lower-roman":"","upper-alpha":"","upper-roman":""},insertunorderedlist:{circle:"",disc:"",square:""}});this.addInputRule(function(n){r.each(n.getNodesByTagName("li"),function(n){n.children.length==0&&n.parentNode.removeChild(n)})});i.commands.insertorderedlist=i.commands.insertunorderedlist={execCommand:function(i){this.document.execCommand(i);var r=this.selection.getRange(),f=r.createBookmark(!0);return this.$body.find("ol,ul").each(function(i,r){var f=r.parentNode;f.tagName=="P"&&f.lastChild===f.firstChild&&(n(r).children().each(function(t,i){var r=f.cloneNode(!1);n(r).append(i.innerHTML);n(i).html("").append(r)}),n(r).insertBefore(f),n(f).remove());u.$inline[f.tagName]&&(f.tagName=="SPAN"&&n(r).children().each(function(t,i){var r=f.cloneNode(!1);if(i.firstChild.nodeName!="P"){while(i.firstChild)r.appendChild(i.firstChild);n("<p><\/p>").appendTo(i).append(r)}else{while(i.firstChild)r.appendChild(i.firstChild);n(i.firstChild).append(r)}}),t.remove(f,!0))}),r.moveToBookmark(f).select(),!0},queryCommandState:function(n){return this.document.queryCommandState(n)}}},function(){var t={textarea:function(n,t){var r=t.ownerDocument.createElement("textarea");return r.style.cssText="resize:none;border:0;padding:0;margin:0;overflow-y:auto;outline:0",i.ie&&i.version<8&&(r.style.width=t.offsetWidth+"px",r.style.height=t.offsetHeight+"px",t.onresize=function(){r.style.width=t.offsetWidth+"px";r.style.height=t.offsetHeight+"px"}),t.appendChild(r),{container:r,setContent:function(n){r.value=n},getContent:function(){return r.value},select:function(){var n;i.ie?(n=r.createTextRange(),n.collapse(!0),n.select()):(r.setSelectionRange(0,0),r.focus())},dispose:function(){t.removeChild(r);t.onresize=null;r=null;t=null}}}};UM.plugins.source=function(){function l(n){return t.textarea(r,n)}var r=this,c=this.options,e=!1,f,s,h,o;c.sourceEditor="textarea";r.setOpt({sourceEditorFirst:!1});s=r.getContent;r.commands.source={execCommand:function(){var t,a,c,o,v;if(e=!e,e)h=r.selection.getRange().createAddress(!1,!0),r.undoManger&&r.undoManger.save(!0),i.gecko&&(r.body.contentEditable=!1),r.body.style.cssText+=";position:absolute;left:-32768px;top:-32768px;",r.fireEvent("beforegetcontent"),t=UM.htmlparser(r.body.innerHTML),r.filterOutputRule(t),t.traversal(function(n){if(n.type=="element")switch(n.tagName){case"td":case"th":case"caption":n.children&&n.children.length==1&&n.firstChild().tagName=="br"&&n.removeChild(n.firstChild());break;case"pre":n.innerText(n.innerText().replace(/&nbsp;/g," "))}}),r.fireEvent("aftergetcontent"),a=t.toHtml(!0),f=l(r.body.parentNode),f.setContent(a),c=function(t){return parseInt(n(r.body).css(t))},n(f.container).width(n(r.body).width()+c("padding-left")+c("padding-right")).height(n(r.body).height()),setTimeout(function(){f.select()}),r.getContent=function(){return f.getContent()||"<p>"+(i.ie?"":"<br/>")+"<\/p>"};else{r.$body.css({position:"",left:"",top:""});o=f.getContent()||"<p>"+(i.ie?"":"<br/>")+"<\/p>";o=o.replace(new RegExp("[\\r\\t\\n ]*<\/?(\\w+)\\s*(?:[^>]*)>","g"),function(n,t){return t&&!u.$inlineWithA[t.toLowerCase()]?n.replace(/(^[\n\r\t ]*)|([\n\r\t ]*$)/g,""):n.replace(/(^[\n\r\t]*)|([\n\r\t]*$)/g,"")});r.setContent(o);f.dispose();f=null;r.getContent=s;v=r.body.firstChild;v||(r.body.innerHTML="<p>"+(i.ie?"":"<br/>")+"<\/p>");r.undoManger&&r.undoManger.save(!0);i.gecko&&(r.body.contentEditable=!0);try{r.selection.getRange().moveToAddress(h).select()}catch(y){}}this.fireEvent("sourcemodechanged",e)},queryCommandState:function(){return e|0},notNeedUndo:1};o=r.queryCommandState;r.queryCommandState=function(n){return(n=n.toLowerCase(),e)?n in{source:1,fullscreen:1}?o.apply(this,arguments):-1:o.apply(this,arguments)}}}();UM.plugins.enterkey=function(){var u,r=this,f=r.options.enterTag;r.addListener("keyup",function(n,f){var v=f.keyCode||f.which,o,h,c,a,s,e,l;if(v==13)if(o=r.selection.getRange(),h=o.startContainer,i.ie)r.fireEvent("saveScene",!0,!0);else{if(/h\d/i.test(u)){if(i.gecko)a=t.findParentByTagName(h,["h1","h2","h3","h4","h5","h6","blockquote","caption","table"],!0),a||(r.document.execCommand("formatBlock",!1,"<p>"),c=1);else if(h.nodeType==1){if(s=r.document.createTextNode(""),o.insertNode(s),e=t.findParentByTagName(s,"div",!0),e){for(l=r.document.createElement("p");e.firstChild;)l.appendChild(e.firstChild);e.parentNode.insertBefore(l,e);t.remove(e);o.setStartBefore(s).setCursor();c=1}t.remove(s)}r.undoManger&&c&&r.undoManger.save()}i.opera&&o.select()}});r.addListener("keydown",function(n,e){var l=e.keyCode||e.which,s;if(l==13){if(r.fireEvent("beforeenterkeydown")){t.preventDefault(e);return}if(r.fireEvent("saveScene",!0,!0),u="",s=r.selection.getRange(),!s.collapsed){var o=s.startContainer,a=s.endContainer,h=t.findParentByTagName(o,"td",!0),c=t.findParentByTagName(a,"td",!0);if(h&&c&&h!==c||!h&&c||h&&!c){e.preventDefault?e.preventDefault():e.returnValue=!1;return}}f=="p"&&(i.ie||(o=t.findParentByTagName(s.startContainer,["ol","ul","p","h1","h2","h3","h4","h5","h6","blockquote","caption"],!0),o||i.opera?(u=o.tagName,o.tagName.toLowerCase()=="p"&&i.gecko&&t.removeDirtyAttr(o)):(r.document.execCommand("formatBlock",!1,"<p>"),i.gecko&&(s=r.selection.getRange(),o=t.findParentByTagName(s.startContainer,"p",!0),o&&t.removeDirtyAttr(o)))))}});i.ie&&r.addListener("setDisabled",function(){n(r.body).find("p").each(function(n,i){t.isEmptyBlock(i)&&(i.innerHTML="&nbsp;")})})};UM.commands.preview={execCommand:function(){var r=window.open("","_blank",""),n=r.document,i=this.getContent(null,null,!0),t=this.getOpt("UMEDITOR_HOME_URL"),u=i.indexOf("mathquill-embedded-latex")!=-1?'<link rel="stylesheet" href="'+t+'third-party/mathquill/mathquill.css"/><script src="'+t+'third-party/jquery.min.js"><\/script><script src="'+t+'third-party/mathquill/mathquill.min.js"><\/script>':"";n.open();n.write("<html><head>"+u+"<\/head><body><div>"+i+"<\/div><\/body><\/html>");n.close()},notNeedUndo:1};UM.plugins.basestyle=function(){var t=this;t.addshortcutkey({Bold:"ctrl+66",Italic:"ctrl+73",Underline:"ctrl+shift+85",strikeThrough:"ctrl+shift+83"});t.addOutputRule(function(t){n.each(t.getNodesByTagName("b i u strike s"),function(n,t){switch(t.tagName){case"b":t.tagName="strong";break;case"i":t.tagName="em";break;case"u":t.tagName="span";t.setStyle("text-decoration","underline");break;case"s":case"strike":t.tagName="span";t.setStyle("text-decoration","line-through")}})});n.each(["bold","underline","superscript","subscript","italic","strikethrough"],function(r,u){t.commands[u]={execCommand:function(n){var i=this.selection.getRange(),t;return i.collapsed&&this.queryCommandState(n)!=1?(t=this.document.createElement({bold:"strong",underline:"u",superscript:"sup",subscript:"sub",italic:"em",strikethrough:"strike"}[n]),i.insertNode(t).setStart(t,0).setCursor(!1),!0):this.document.execCommand(n)},queryCommandState:function(t){if(i.gecko)return this.document.queryCommandState(t);var u=this.selection.getStartElementPath(),r=!1;return n.each(u,function(i,u){switch(t){case"bold":if(u.nodeName=="STRONG"||u.nodeName=="B")return r=1,!1;break;case"underline":if(u.nodeName=="U"||u.nodeName=="SPAN"&&n(u).css("text-decoration")=="underline")return r=1,!1;break;case"superscript":if(u.nodeName=="SUP")return r=1,!1;break;case"subscript":if(u.nodeName=="SUB")return r=1,!1;break;case"italic":if(u.nodeName=="EM"||u.nodeName=="I")return r=1,!1;break;case"strikethrough":if(u.nodeName=="S"||u.nodeName=="STRIKE"||u.nodeName=="SPAN"&&n(u).css("text-decoration")=="line-through")return r=1,!1}}),r}}})};UM.plugins.video=function(){function t(t,i,r,u,f,e){return e?'<embed type="application/x-shockwave-flash" class="edui-faked-video" pluginspage="http://www.macromedia.com/go/getflashplayer" src="'+t+'" width="'+i+'" height="'+r+'"'+(f?' style="float:'+f+'"':"")+' wmode="transparent" play="true" loop="false" menu="false" allowscriptaccess="never" allowfullscreen="true" >':"<img "+(u?'id="'+u+'"':"")+' width="'+i+'" height="'+r+'" _url="'+t+'" class="edui-faked-video" src="'+n.options.UMEDITOR_HOME_URL+'themes/default/images/spacer.gif" style="background:url('+n.options.UMEDITOR_HOME_URL+"themes/default/images/videologo.gif) no-repeat center center; border:1px solid gray;"+(f?"float:"+f+";":"")+'" />'}function i(n,i){r.each(n.getNodesByTagName(i?"img":"embed"),function(n){if(n.getAttr("class")=="edui-faked-video"){var r=t(i?n.getAttr("_url"):n.getAttr("src"),n.getAttr("width"),n.getAttr("height"),null,n.getStyle("float")||"",i);n.parentNode.replaceChild(UM.uNode.createElement(r),n)}})}var n=this;n.addOutputRule(function(n){i(n,!0)});n.addInputRule(function(n){i(n)});n.commands.insertvideo={execCommand:function(i,u){var o,s,f,e,h;for(u=r.isArray(u)?u:[u],o=[],s="tmpVedio",f=0,h=u.length;f<h;f++)e=u[f],o.push(t(e.url,e.width||420,e.height||280,s+f,e.align,!1));n.execCommand("inserthtml",o.join(""),!0)},queryCommandState:function(){var t=n.selection.getRange().getClosedNode(),i=t&&t.className=="edui-faked-video";return i?1:0}}};UM.plugins.selectall=function(){var n=this;n.commands.selectall={execCommand:function(){var u=this,n=u.body,r=u.selection.getRange();r.selectNodeContents(n);t.isEmptyBlock(n)&&(i.opera&&n.firstChild&&n.firstChild.nodeType==1&&r.setStartAtFirst(n.firstChild),r.collapse(!0));r.select(!0)},notNeedUndo:1};n.addshortcutkey({selectAll:"ctrl+65"})};UM.plugins.removeformat=function(){var n=this;n.setOpt({removeFormatTags:"b,big,code,del,dfn,em,font,i,ins,kbd,q,samp,small,span,strike,strong,sub,sup,tt,u,var",removeFormatAttributes:"class,style,lang,width,height,align,hspace,valign"});n.commands.removeformat={execCommand:function(n,r,e,o,s){function y(n){var t,r,u;if(n.nodeType==3||n.tagName.toLowerCase()!="span")return 0;if(i.ie&&(t=n.attributes,t.length)){for(r=0,u=t.length;r<u;r++)if(t[r].specified)return 0;return 1}return!n.attributes.length}function w(n){var k=n.createBookmark(),o,r,w,f,i,l,b;for(n.collapsed&&n.enlarge(!0),s||(o=t.findParentByTagName(n.startContainer,"a",!0),o&&n.setStartBefore(o),o=t.findParentByTagName(n.endContainer,"a",!0),o&&n.setEndAfter(o)),h=n.createBookmark(),i=h.start;(c=i.parentNode)&&!t.isBlockElm(c);)t.breakParent(i,c),t.clearEmptySibling(i);if(h.end){for(i=h.end;(c=i.parentNode)&&!t.isBlockElm(c);)t.breakParent(i,c),t.clearEmptySibling(i);for(r=t.getNextDomNode(h.start,!1,v);r;){if(r==h.end)break;w=t.getNextDomNode(r,!0,v);u.$empty[r.tagName.toLowerCase()]||t.isBookmarkNode(r)||(p.test(r.tagName)?e?(t.removeStyle(r,e),y(r)&&e!="text-decoration"&&t.remove(r,!0)):t.remove(r,!0):u.$tableContent[r.tagName]||u.$list[r.tagName]||(t.removeAttributes(r,a),y(r)&&t.remove(r,!0)));r=w}}for(f=h.start.parentNode,!t.isBlockElm(f)||u.$tableContent[f.tagName]||u.$list[f.tagName]||t.removeAttributes(f,a),f=h.end.parentNode,h.end&&t.isBlockElm(f)&&!u.$tableContent[f.tagName]&&!u.$list[f.tagName]&&t.removeAttributes(f,a),n.moveToBookmark(h).moveToBookmark(k),i=n.startContainer,b=n.collapsed;i.nodeType==1&&t.isEmptyNode(i)&&u.$removeEmpty[i.tagName];)l=i.parentNode,n.setStartBefore(i),n.startContainer===n.endContainer&&n.endOffset--,t.remove(i),i=l;if(!b)for(i=n.endContainer;i.nodeType==1&&t.isEmptyNode(i)&&u.$removeEmpty[i.tagName];)l=i.parentNode,n.setEndBefore(i),t.remove(i),i=l}var p=new RegExp("^(?:"+(r||this.options.removeFormatTags).replace(/,/g,"|")+")$","i"),a=e?[]:(o||this.options.removeFormatAttributes).split(","),l=new f.Range(this.document),h,c,v=function(n){return n.nodeType==1};l=this.selection.getRange();l.collapsed||(w(l),l.select())}}};UM.plugins.keystrokes=function(){var r=this,u=!0;r.addListener("keydown",function(f,e){var c=e.keyCode||e.which,o=r.selection.getRange(),h,s,y,a,v,p,l;if(!o.collapsed&&!(e.ctrlKey||e.shiftKey||e.altKey||e.metaKey)&&(c>=65&&c<=90||c>=48&&c<=57||c>=96&&c<=111||{13:1,8:1,46:1}[c])&&(h=o.startContainer,t.isFillChar(h)&&o.setStartBefore(h),h=o.endContainer,t.isFillChar(h)&&o.setEndAfter(h),o.txtToElmBoundary(),o.endContainer&&o.endContainer.nodeType==1&&(h=o.endContainer.childNodes[o.endOffset],h&&t.isBr(h)&&o.setEndAfter(h)),o.startOffset==0&&(h=o.startContainer,t.isBoundaryNode(h,"firstChild")&&(h=o.endContainer,o.endOffset==(h.nodeType==3?h.nodeValue.length:h.childNodes.length)&&t.isBoundaryNode(h,"lastChild"))))){r.fireEvent("saveScene");r.body.innerHTML="<p>"+(i.ie?"":"<br/>")+"<\/p>";o.setStart(r.body.firstChild,0).setCursor(!1,!0);r._selectionChange();return}if(c==8){if(o=r.selection.getRange(),u=o.collapsed,r.fireEvent("delkeydown",e))return;if(o.collapsed&&o.inFillChar()&&(s=o.startContainer,t.isFillChar(s)?(o.setStartBefore(s).shrinkBoundary(!0).collapse(!0),t.remove(s)):(s.nodeValue=s.nodeValue.replace(new RegExp("^"+t.fillChar),""),o.startOffset--,o.collapse(!0).select(!0))),s=o.getClosedNode()){r.fireEvent("saveScene");o.setStartBefore(s);t.remove(s);o.setCursor();r.fireEvent("saveScene");t.preventDefault(e);return}if(!i.ie&&(s=t.findParentByTagName(o.startContainer,"table",!0),y=t.findParentByTagName(o.endContainer,"table",!0),s&&!y||!s&&y||s!==y)){e.preventDefault();return}if(s=o.startContainer,o.collapsed&&s.nodeType==1&&(a=s.childNodes[o.startOffset-1],a&&a.nodeType==1&&a.tagName=="BR"&&(r.fireEvent("saveScene"),o.setStartBefore(a).collapse(!0),t.remove(a),o.select(),r.fireEvent("saveScene"))),i.chrome&&o.collapsed){while(o.startOffset==0&&!t.isEmptyBlock(o.startContainer))o.setStartBefore(o.startContainer);v=o.startContainer.childNodes[o.startOffset-1];v&&v.nodeName=="BR"&&(o.setStartBefore(v),r.fireEvent("saveScene"),n(v).remove(),o.setCursor(),r.fireEvent("saveScene"))}}if(i.gecko&&c==46&&(p=r.selection.getRange(),p.collapsed&&(s=p.startContainer,t.isEmptyBlock(s)))){for(l=s.parentNode;t.getChildCount(l)==1&&!t.isBody(l);)s=l,l=l.parentNode;s===l.lastChild&&e.preventDefault();return}});r.addListener("keyup",function(n,r){var a=r.keyCode||r.which,f,c=this,l,o,s,e,h;if(a==8){if(c.fireEvent("delkeyup"))return;if(f=c.selection.getRange(),f.collapsed){if(l=["h1","h2","h3","h4","h5","h6"],(e=t.findParentByTagName(f.startContainer,l,!0))&&t.isEmptyBlock(e)){if(o=e.previousSibling,o&&o.nodeName!="TABLE"){t.remove(e);f.setStartAtLast(o).setCursor(!1,!0);return}if(s=e.nextSibling,s&&s.nodeName!="TABLE"){t.remove(e);f.setStartAtFirst(s).setCursor(!1,!0);return}}t.isBody(f.startContainer)&&(e=t.createElement(c.document,"p",{innerHTML:i.ie?t.fillChar:"<br/>"}),f.insertNode(e).setStart(e,0).setCursor(!1,!0))}!u&&(f.startContainer.nodeType==3||f.startContainer.nodeType==1&&t.isEmptyBlock(f.startContainer))&&(i.ie?(h=f.document.createElement("span"),f.insertNode(h).setStartBefore(h).collapse(!0),f.select(),t.remove(h)):f.select())}})};UM.plugins.autosave=function(){function f(i){var f=null;if(!(new Date-u<e)){if(!i.hasContents()){t&&r.removeItem(t);return}(u=new Date,i._saveFlag=null,f=n.body.innerHTML,i.fireEvent("beforeautosave",{content:f})!==!1)&&(r.saveLocalData(t,f),i.fireEvent("afterautosave",{content:f}))}}var n=this,u=new Date,e=20,t=null,r;n.setOpt("saveInterval",500);r=UM.LocalStorage=function(){function i(){var n=document.createElement("div");return(n.style.display="none",!n.addBehavior)?null:(n.addBehavior("#default#userdata"),{getItem:function(i){var r=null;try{document.body.appendChild(n);n.load(t);r=n.getAttribute(i);document.body.removeChild(n)}catch(u){}return r},setItem:function(i,r){document.body.appendChild(n);n.setAttribute(i,r);n.save(t);document.body.removeChild(n)},removeItem:function(i){document.body.appendChild(n);n.removeAttribute(i);n.save(t);document.body.removeChild(n)}})}var n=window.localStorage||i()||null,t="localStorage";return{saveLocalData:function(t,i){return n&&i?(n.setItem(t,i),!0):!1},getLocalData:function(t){return n?n.getItem(t):null},removeItem:function(t){n&&n.removeItem(t)}}}();n.addListener("ready",function(){var i="-drafts-data",r=null;r=n.key?n.key+i:(n.container.parentNode.id||"ue-common")+i;t=(location.protocol+location.host+location.pathname).replace(/[.:\/]/g,"_")+r});n.addListener("contentchange",function(){t&&(n._saveFlag&&window.clearTimeout(n._saveFlag),n.options.saveInterval>0?n._saveFlag=window.setTimeout(function(){f(n)},n.options.saveInterval):f(n))});n.commands.clearlocaldata={execCommand:function(){t&&r.getLocalData(t)&&r.removeItem(t)},notNeedUndo:!0,ignoreContentChange:!0};n.commands.getlocaldata={execCommand:function(){return t?r.getLocalData(t)||"":""},notNeedUndo:!0,ignoreContentChange:!0};n.commands.drafts={execCommand:function(){t&&(n.body.innerHTML=r.getLocalData(t)||"<p>"+(i.ie?"&nbsp;":"<br/>")+"<\/p>",n.focus(!0))},queryCommandState:function(){return t?r.getLocalData(t)===null?-1:0:-1},notNeedUndo:!0,ignoreContentChange:!0}};UM.plugins.autoupload=function(){function i(n){return n.clipboardData&&n.clipboardData.items&&n.clipboardData.items.length==1&&/^image\//.test(n.clipboardData.items[0].type)?n.clipboardData.items:null}function r(n){return n.dataTransfer&&n.dataTransfer.files?n.dataTransfer.files:null}var n=this,t;n.setOpt("pasteImageEnabled",!0);n.setOpt("dropFileEnabled",!0);t=function(t,i){var u=new FormData,r;u.append(i.options.imageFieldName||"upfile",t,t.name||"blob."+t.type.substr(6));u.append("type","ajax");r=new XMLHttpRequest;r.open("post",n.options.imageUrl,!0);r.setRequestHeader("X-Requested-With","XMLHttpRequest");r.addEventListener("load",function(e){try{var json=eval("("+e.target.response+")"),link=json.url,picLink=n.options.imagePath+link;i.execCommand("insertimage",{src:picLink,_src:picLink})}catch(er){}});r.send(u)};n.addListener("ready",function(){if(window.FormData&&window.FileReader){var u=function(u){var s=!1,e,o,f;if(e=u.type=="paste"?i(u.originalEvent):r(u.originalEvent),e){for(o=e.length;o--;)f=e[o],f.getAsFile&&(f=f.getAsFile()),f&&f.size>0&&/image\/\w+/i.test(f.type)&&(t(f,n),s=!0);if(s)return!1}};n.getOpt("pasteImageEnabled")&&n.$body.on("paste",u);n.getOpt("dropFileEnabled")&&n.$body.on("drop",u);n.$body.on("dragover",function(n){if(n.originalEvent.dataTransfer.types[0]=="Files")return!1})}})};UM.plugins.formula=function(){function u(){return t.$body.find("iframe.edui-formula-active")[0]||null}function f(){var n=u();n&&n.contentWindow.formula.blur()}var t=this;t.addInputRule(function(i){n.each(i.getNodesByTagName("span"),function(n,i){if(i.hasClass("mathquill-embedded-latex")){for(var u,f="";u=i.firstChild();)f+=u.data,i.removeChild(u);i.tagName="iframe";i.setAttr({frameborder:"0",src:t.getOpt("UMEDITOR_HOME_URL")+"dialogs/formula/formula.html","data-latex":r.unhtml(f)})}})});t.addOutputRule(function(t){n.each(t.getNodesByTagName("iframe"),function(n,t){t.hasClass("mathquill-embedded-latex")&&(t.tagName="span",t.appendChild(UM.uNode.createText(t.getAttr("data-latex"))),t.setAttr({frameborder:"",src:"","data-latex":""}))})});t.addListener("click",function(){f()});t.addListener("afterexeccommand",function(n,t){t!="formula"&&f()});t.commands.formula={execCommand:function(n,r){var f=u();f?f.contentWindow.formula.insertLatex(r):(t.execCommand("inserthtml",'<span class="mathquill-embedded-latex">'+r+"<\/span>"),i.ie&&i.ie9below&&setTimeout(function(){var n=t.selection.getRange(),i=n.startContainer;i.nodeType!=1||i.childNodes[n.startOffset]||(n.insertNode(t.document.createTextNode(" ")),n.setCursor())},100))},queryCommandState:function(){return 0},queryCommandValue:function(){var n=u();return n&&n.contentWindow.formula.getLatex()}}},function(n){function f(t,r,u){if(t.prototype=n.extend2(n.extend({},r),(UM.ui[u]||i).prototype,!0),t.prototype.supper=(UM.ui[u]||i).prototype,UM.ui[u]&&UM.ui[u].prototype.defaultOpt){var f=UM.ui[u].prototype.defaultOpt,e=t.prototype.defaultOpt;t.prototype.defaultOpt=n.extend({},f,e||{})}return t}function e(i,r){n[t+r]=i;n.fn[t+r]=function(t){var r,u=Array.prototype.slice.call(arguments,1);return this.each(function(f,e){var s=n(e),o=s.edui();if(o||(i(!t||!n.isPlainObject(t)?{}:t,s),s.edui(o)),n.type(t)=="string")if(t=="this")r=o;else{if(r=o[t].apply(o,u),r!==o&&r!==undefined)return!1;r=null}}),r!==null?r:this}}var u;n.parseTmpl=function(n,t){var r="var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('"+n.replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(/<%=([\s\S]+?)%>/g,function(n,t){return"',"+t.replace(/\\'/g,"'")+",'"}).replace(/<%([\s\S]+?)%>/g,function(n,t){return"');"+t.replace(/\\'/g,"'").replace(/[\r\n\t]/g," ")+"__p.push('"}).replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/\t/g,"\\t")+"');}return __p.join('');",i=new Function("obj",r);return t?i(t):i};n.extend2=function(t){for(var f,r,i=arguments,e=n.type(i[i.length-1])=="boolean"?i[i.length-1]:!1,o=n.type(i[i.length-1])=="boolean"?i.length-1:i.length,u=1;u<o;u++){f=i[u];for(r in f)e&&t.hasOwnProperty(r)||(t[r]=f[r])}return t};n.IE6=!!window.ActiveXObject&&parseFloat(navigator.userAgent.match(/msie (\d+)/i)[1])==6;var r=[],i=function(){},t="edui";i.prototype={on:function(t,i){this.root().on(t,n.proxy(i,this));return this},off:function(t,i){return this.root().off(t,n.proxy(i,this)),this},trigger:function(n,t){return this.root().trigger(n,t)===!1?!1:this},root:function(n){return this._$el||(this._$el=n)},destroy:function(){},data:function(n,i){return i!==undefined?(this.root().data(t+n,i),this):this.root().data(t+n)},register:function(t,i,u){r.push({evtname:t,$els:n.isArray(i)?i:[i],handler:n.proxy(u,i)})}};n.fn.edui=function(n){return n?this.data("eduiwidget",n):this.data("eduiwidget")};u=1;UM.ui={define:function(i,r,o){var s=UM.ui[i]=f(function(r,f){var o=function(){},e;if(n.extend(o.prototype,s.prototype,{guid:i+u++,widgetName:i}),e=new o,n.type(r)=="string")return e.init&&e.init({}),e.root().edui(e),e.root().find("a").click(function(n){n.preventDefault()}),e.root()[t+i].apply(e.root(),arguments);f&&e.root(f);e.init&&e.init(!r||n.isPlainObject(r)?n.extend2(r||{},e.defaultOpt||{},!0):r);try{e.root().find("a").click(function(n){n.preventDefault()})}catch(h){}return e.root().edui(e)},r,o);e(s,i)}};n(function(){n(document).on("click mouseup mousedown dblclick mouseover",function(t){n.each(r,function(i,r){r.evtname==t.type&&n.each(r.$els,function(i,u){u[0]===t.target||n.contains(u[0],t.target)||r.handler(t)})})})})}(jQuery);UM.ui.define("button",{tpl:'<<%if(!texttype){%>div class="edui-btn edui-btn-<%=icon%> <%if(name){%>edui-btn-name-<%=name%><%}%>" unselectable="on" onmousedown="return false" <%}else{%>a class="edui-text-btn"<%}%><% if(title) {%> data-original-title="<%=title%>" <%};%>> '+'<% if(icon) {%><div unselectable="on" class="edui-icon-<%=icon%> edui-icon"><\/div><% }; %><%if(text) {%><span unselectable="on" onmousedown="return false" class="edui-button-label"><%=text%><\/span><%}%>'+'<%if(caret && text){%><span class="edui-button-spacing"><\/span><%}%>'+'<% if(caret) {%><span unselectable="on" onmousedown="return false" class="edui-caret"><\/span><% };%><\/<%if(!texttype){%>div<%}else{%>a<%}%>>',defaultOpt:{text:"",title:"",icon:"",width:"",caret:!1,texttype:!1,click:function(){}},init:function(t){var i=this;return i.root(n(n.parseTmpl(i.tpl,t))).click(function(n){i.wrapclick(t.click,n)}),i.root().hover(function(){i.root().hasClass("edui-disabled")||i.root().toggleClass("edui-hover")}),i},wrapclick:function(t,i){return this.disabled()||(this.root().trigger("wrapclick"),n.proxy(t,this,i)()),this},label:function(n){return n===undefined?this.root().find(".edui-button-label").text():(this.root().find(".edui-button-label").text(n),this)},disabled:function(n){return n===undefined?this.root().hasClass("edui-disabled"):(this.root().toggleClass("edui-disabled",n),this.root().hasClass("edui-disabled")&&this.root().removeClass("edui-hover"),this)},active:function(n){return n===undefined?this.root().hasClass("edui-active"):(this.root().toggleClass("edui-active",n),this)},mergeWith:function(t){var i=this;i.data("$mergeObj",t);t.edui().data("$mergeObj",i.root());n.contains(document.body,t[0])||t.appendTo(i.root());i.on("click",function(){i.wrapclick(function(){t.edui().show()})}).register("click",i.root(),function(){t.hide()})}}),function(){UM.ui.define("toolbar",{tpl:'<div class="edui-toolbar"  ><div class="edui-btn-toolbar" unselectable="on" onmousedown="return false"  ><\/div><\/div>',init:function(){var t=this.root(n(this.tpl));this.data("$btnToolbar",t.find(".edui-btn-toolbar"))},appendToBtnmenu:function(t){var i=this.data("$btnToolbar");t=n.isArray(t)?t:[t];n.each(t,function(n,t){i.append(t)})}})}();UM.ui.define("menu",{show:function(t,i,r,u,f){(r=r||"position",this.trigger("beforeshow")!==!1)&&(this.root().css(n.extend({display:"block"},t?{top:t[r]().top+(i=="right"?0:t.outerHeight())-(u||0),left:t[r]().left+(i=="right"?t.outerWidth():0)-(f||0)}:{})),this.trigger("aftershow"))},hide:function(n){var t;this.trigger("beforehide")!==!1&&((t=this.root().data("parentmenu"))&&(t.data("parentmenu")||n)&&t.edui().hide(),this.root().css("display","none"),this.trigger("afterhide"))},attachTo:function(n){var t=this;if(!n.data("$mergeObj")){n.data("$mergeObj",t.root());n.on("wrapclick",function(){t.show()});t.register("click",n,function(){t.hide()});t.data("$mergeObj",n)}}});UM.ui.define("dropmenu",{tmpl:'<ul class="edui-dropdown-menu" aria-labelledby="dropdownMenu" >'+"<%for(var i=0,ci;ci=data[i++];){%>"+'<%if(ci.divider){%><li class="edui-divider"><\/li><%}else{%>'+"<li <%if(ci.active||ci.disabled){%>class=\"<%= ci.active|| '' %> <%=ci.disabled||'' %>\" <%}%> data-value=\"<%= ci.value%>\">"+'<a href="#" tabindex="-1"><em class="edui-dropmenu-checkbox"><i class="edui-icon-ok"><\/i><\/em><%= ci.label%><\/a>'+"<\/li><%}%>"+"<%}%>"+"<\/ul>",defaultOpt:{data:[],click:function(){}},init:function(t){var i=this,r={click:1,mouseover:1,mouseout:1};this.root(n(n.parseTmpl(this.tmpl,t))).on("click",'li[class!="edui-disabled edui-divider edui-dropdown-submenu"]',function(r){n.proxy(t.click,i,r,n(this).data("value"),n(this))()}).find("li").each(function(u,f){var o=n(this),e;o.hasClass("edui-disabled edui-divider edui-dropdown-submenu")||(e=t.data[u],n.each(r,function(t){e[t]&&o[t](function(r){n.proxy(e[t],f)(r,e,i.root)})}))})},disabled:function(t){n("li[class!=edui-divider]",this.root()).each(function(){var i=n(this);t===!0?i.addClass("edui-disabled"):n.isFunction(t)?i.toggleClass("edui-disabled",t(li)):i.removeClass("edui-disabled")})},val:function(t){var i;return n('li[class!="edui-divider edui-disabled edui-dropdown-submenu"]',this.root()).each(function(){var r=n(this);if(t===undefined){if(r.find("em.edui-dropmenu-checked").length)return i=r.data("value"),!1}else r.find("em").toggleClass("edui-dropmenu-checked",r.data("value")==t)}),t===undefined?i:void 0},addSubmenu:function(t,i,r){r=r||0;var u=n("li[class!=edui-divider]",this.root()),f=n('<li class="edui-dropdown-submenu"><a tabindex="-1" href="#">'+t+"<\/a><\/li>").append(i);r>=0&&r<u.length?f.insertBefore(u[r]):r<0?f.insertBefore(u[0]):r>=u.length&&f.appendTo(u)}},"menu");UM.ui.define("splitbutton",{tpl:'<div class="edui-splitbutton <%if (name){%>edui-splitbutton-<%= name %><%}%>"  unselectable="on" <%if(title){%>data-original-title="<%=title%>"<%}%>><div class="edui-btn"  unselectable="on" ><%if(icon){%><div  unselectable="on" class="edui-icon-<%=icon%> edui-icon"><\/div><%}%><%if(text){%><%=text%><%}%><\/div>'+'<div  unselectable="on" class="edui-btn edui-dropdown-toggle" ><div  unselectable="on" class="edui-caret"><\/div><\/div><\/div>',defaultOpt:{text:"",title:"",click:function(){}},init:function(t){var i=this;return i.root(n(n.parseTmpl(i.tpl,t))),i.root().find(".edui-btn:first").click(function(){i.disabled()||n.proxy(t.click,i)()}),i.root().find(".edui-dropdown-toggle").click(function(){i.disabled()||i.trigger("arrowclick")}),i.root().hover(function(){i.root().hasClass("edui-disabled")||i.root().toggleClass("edui-hover")}),i},wrapclick:function(t,i){return this.disabled()||n.proxy(t,this,i)(),this},disabled:function(n){return n===undefined?this.root().hasClass("edui-disabled"):(this.root().toggleClass("edui-disabled",n).find(".edui-btn").toggleClass("edui-disabled",n),this)},active:function(n){return n===undefined?this.root().hasClass("edui-active"):(this.root().toggleClass("edui-active",n).find(".edui-btn:first").toggleClass("edui-active",n),this)},mergeWith:function(t){var i=this;i.data("$mergeObj",t);t.edui().data("$mergeObj",i.root());n.contains(document.body,t[0])||t.appendTo(i.root());i.root().delegate(".edui-dropdown-toggle","click",function(){i.wrapclick(function(){t.edui().show()})});i.register("click",i.root().find(".edui-dropdown-toggle"),function(){t.hide()})}});UM.ui.define("colorsplitbutton",{tpl:'<div class="edui-splitbutton <%if (name){%>edui-splitbutton-<%= name %><%}%>"  unselectable="on" <%if(title){%>data-original-title="<%=title%>"<%}%>><div class="edui-btn"  unselectable="on" ><%if(icon){%><div  unselectable="on" class="edui-icon-<%=icon%> edui-icon"><\/div><%}%><div class="edui-splitbutton-color-label" <%if (color) {%>style="background: <%=color%>"<%}%>><\/div><%if(text){%><%=text%><%}%><\/div>'+'<div  unselectable="on" class="edui-btn edui-dropdown-toggle" ><div  unselectable="on" class="edui-caret"><\/div><\/div><\/div>',defaultOpt:{color:""},init:function(n){var t=this;t.supper.init.call(t,n)},colorLabel:function(){return this.root().find(".edui-splitbutton-color-label")}},"splitbutton");UM.ui.define("popup",{tpl:'<div class="edui-dropdown-menu edui-popup"'+'<%if(!<%=stopprop%>){%>onmousedown="return false"<%}%>'+'><div class="edui-popup-body" unselectable="on" onmousedown="return false"><%=subtpl%><\/div>'+'<div class="edui-popup-caret"><\/div><\/div>',defaultOpt:{stopprop:!1,subtpl:"",width:"",height:""},init:function(t){return this.root(n(n.parseTmpl(this.tpl,t))),this},mergeTpl:function(t){return n.parseTmpl(this.tpl,{subtpl:t})},show:function(t,i){i||(i={});var r=i.fnname||"position";this.trigger("beforeshow")!==!1&&(this.root().css(n.extend({display:"block"},t?{top:t[r]().top+(i.dir=="right"?0:t.outerHeight())-(i.offsetTop||0),left:t[r]().left+(i.dir=="right"?t.outerWidth():0)-(i.offsetLeft||0),position:"absolute"}:{})),this.root().find(".edui-popup-caret").css({top:i.caretTop||0,left:i.caretLeft||0,position:"absolute"}).addClass(i.caretDir||"up"),this.trigger("aftershow"))},hide:function(){this.root().css("display","none");this.trigger("afterhide")},attachTo:function(n,t){var i=this;if(!n.data("$mergeObj")){n.data("$mergeObj",i.root());n.on("wrapclick",function(){i.show(n,t)});i.register("click",n,function(){i.hide()});i.data("$mergeObj",n)}},getBodyContainer:function(){return this.root().find(".edui-popup-body")}});UM.ui.define("scale",{tpl:'<div class="edui-scale" unselectable="on"><span class="edui-scale-hand0"><\/span><span class="edui-scale-hand1"><\/span><span class="edui-scale-hand2"><\/span><span class="edui-scale-hand3"><\/span><span class="edui-scale-hand4"><\/span><span class="edui-scale-hand5"><\/span><span class="edui-scale-hand6"><\/span><span class="edui-scale-hand7"><\/span><\/div>',defaultOpt:{$doc:n(document),$wrap:n(document)},init:function(t){return t.$doc&&(this.defaultOpt.$doc=t.$doc),t.$wrap&&(this.defaultOpt.$wrap=t.$wrap),this.root(n(n.parseTmpl(this.tpl,t))),this.initStyle(),this.startPos=this.prePos={x:0,y:0},this.dragId=-1,this},initStyle:function(){r.cssRule("edui-style-scale",".edui-scale{display:none;position:absolute;border:1px solid #38B2CE;cursor:hand;}.edui-scale span{position:absolute;left:0;top:0;width:7px;height:7px;overflow:hidden;font-size:0px;display:block;background-color:#3C9DD0;}.edui-scale .edui-scale-hand0{cursor:nw-resize;top:0;margin-top:-4px;left:0;margin-left:-4px;}.edui-scale .edui-scale-hand1{cursor:n-resize;top:0;margin-top:-4px;left:50%;margin-left:-4px;}.edui-scale .edui-scale-hand2{cursor:ne-resize;top:0;margin-top:-4px;left:100%;margin-left:-3px;}.edui-scale .edui-scale-hand3{cursor:w-resize;top:50%;margin-top:-4px;left:0;margin-left:-4px;}.edui-scale .edui-scale-hand4{cursor:e-resize;top:50%;margin-top:-4px;left:100%;margin-left:-3px;}.edui-scale .edui-scale-hand5{cursor:sw-resize;top:100%;margin-top:-3px;left:0;margin-left:-4px;}.edui-scale .edui-scale-hand6{cursor:s-resize;top:100%;margin-top:-3px;left:50%;margin-left:-4px;}.edui-scale .edui-scale-hand7{cursor:se-resize;top:100%;margin-top:-3px;left:100%;margin-left:-3px;}")},_eventHandler:function(t){var i=this,u=i.defaultOpt.$doc,r,f;switch(t.type){case"mousedown":r=t.target||t.srcElement;r.className.indexOf("edui-scale-hand")!=-1&&(i.dragId=r.className.slice(-1),i.startPos.x=i.prePos.x=t.clientX,i.startPos.y=i.prePos.y=t.clientY,u.bind("mousemove",n.proxy(i._eventHandler,i)));break;case"mousemove":i.dragId!=-1&&(i.updateContainerStyle(i.dragId,{x:t.clientX-i.prePos.x,y:t.clientY-i.prePos.y}),i.prePos.x=t.clientX,i.prePos.y=t.clientY,i.updateTargetElement());break;case"mouseup":i.dragId!=-1&&(i.dragId=-1,i.updateTargetElement(),f=i.data("$scaleTarget"),f.parent()&&i.attachTo(i.data("$scaleTarget")));u.unbind("mousemove",n.proxy(i._eventHandler,i))}},updateTargetElement:function(){var n=this,t=n.root(),i=n.data("$scaleTarget");i.css({width:t.width(),height:t.height()});n.attachTo(i)},updateContainerStyle:function(n,t){var f=this,i=f.root(),r,u=[[0,0,-1,-1],[0,0,0,-1],[0,0,1,-1],[0,0,-1,0],[0,0,1,0],[0,0,-1,1],[0,0,0,1],[0,0,1,1]];u[n][0]!=0&&(r=parseInt(i.offset().left)+t.x,i.css("left",f._validScaledProp("left",r)));u[n][1]!=0&&(r=parseInt(i.offset().top)+t.y,i.css("top",f._validScaledProp("top",r)));u[n][2]!=0&&(r=i.width()+u[n][2]*t.x,i.css("width",f._validScaledProp("width",r)));u[n][3]!=0&&(r=i.height()+u[n][3]*t.y,i.css("height",f._validScaledProp("height",r)))},_validScaledProp:function(n,t){var i=this.root(),r=this.defaultOpt.$doc,u=function(n,i,r){return n+i>r?r-i:t};t=isNaN(t)?0:t;switch(n){case"left":return t<0?0:u(t,i.width(),r.width());case"top":return t<0?0:u(t,i.height(),r.height());case"width":return t<=0?1:u(t,i.offset().left,r.width());case"height":return t<=0?1:u(t,i.offset().top,r.height())}},show:function(t){var i=this;t&&i.attachTo(t);i.root().bind("mousedown",n.proxy(i._eventHandler,i));i.defaultOpt.$doc.bind("mouseup",n.proxy(i._eventHandler,i));i.root().show();i.trigger("aftershow")},hide:function(){var t=this;t.root().unbind("mousedown",n.proxy(t._eventHandler,t));t.defaultOpt.$doc.unbind("mouseup",n.proxy(t._eventHandler,t));t.root().hide();t.trigger("afterhide")},attachTo:function(n){var t=this,r=n.offset(),u=t.root(),i=t.defaultOpt.$wrap,f=i.offset();t.data("$scaleTarget",n);t.root().css({position:"absolute",width:n.width(),height:n.height(),left:r.left-f.left-parseInt(i.css("border-left-width"))-parseInt(u.css("border-left-width")),top:r.top-f.top-parseInt(i.css("border-top-width"))-parseInt(u.css("border-top-width"))})},getScaleTarget:function(){return this.data("$scaleTarget")[0]}});UM.ui.define("colorpicker",{tpl:function(n){for(var i="ffffff,000000,eeece1,1f497d,4f81bd,c0504d,9bbb59,8064a2,4bacc6,f79646,f2f2f2,7f7f7f,ddd9c3,c6d9f0,dbe5f1,f2dcdb,ebf1dd,e5e0ec,dbeef3,fdeada,d8d8d8,595959,c4bd97,8db3e2,b8cce4,e5b9b7,d7e3bc,ccc1d9,b7dde8,fbd5b5,bfbfbf,3f3f3f,938953,548dd4,95b3d7,d99694,c3d69b,b2a2c7,92cddc,fac08f,a5a5a5,262626,494429,17365d,366092,953734,76923c,5f497a,31859b,e36c09,7f7f7f,0c0c0c,1d1b10,0f243e,244061,632423,4f6128,3f3151,205867,974806,c00000,ff0000,ffc000,ffff00,92d050,00b050,00b0f0,0070c0,002060,7030a0,".split(","),r='<div unselectable="on" onmousedown="return false" class="edui-colorpicker<%if (name){%> edui-colorpicker-<%=name%><%}%>" >'+'<table unselectable="on" onmousedown="return false"><tr><td colspan="10">'+n.lang_themeColor+'<\/td> <\/tr><tr class="edui-colorpicker-firstrow" >',t=0;t<i.length;t++)t&&t%10==0&&(r+="<\/tr>"+(t==60?'<tr><td colspan="10">'+n.lang_standardColor+"<\/td><\/tr>":"")+"<tr"+(t==60?' class="edui-colorpicker-firstrow"':"")+">"),r+=t<70?'<td><a unselectable="on" onmousedown="return false" title="'+i[t]+'" class="edui-colorpicker-colorcell" data-color="#'+i[t]+'" style="background-color:#'+i[t]+";border:solid #ccc;"+(t<10||t>=60?"border-width:1px;":t>=10&&t<20?"border-width:1px 1px 0 1px;":"border-width:0 1px 0 1px;")+'"><\/a><\/td>':"";return r+"<\/tr><\/table><\/div>"},init:function(t){var i=this;i.root(n(n.parseTmpl(i.supper.mergeTpl(i.tpl(t)),t)));i.root().on("click",function(t){i.trigger("pickcolor",n(t.target).data("color"))})}},"popup"),function(){var t="edui-combobox-item",r="edui-combobox-item-hover",u="edui-combobox-checked-icon",i="edui-combobox-item-label";UM.ui.define("combobox",function(){return{tpl:'<ul class="dropdown-menu edui-combobox-menu<%if (comboboxName!==\'\') {%> edui-combobox-<%=comboboxName%><%}%>" unselectable="on" onmousedown="return false" role="menu" aria-labelledby="dropdownMenu">'+"<%if(autoRecord) {%>"+"<%for( var i=0, len = recordStack.length; i<len; i++ ) {%>"+"<%var index = recordStack[i];%>"+'<li class="<%=itemClassName%><%if( selected == index ) {%> edui-combobox-checked<%}%>" data-item-index="<%=index%>" unselectable="on" onmousedown="return false">'+'<span class="edui-combobox-icon" unselectable="on" onmousedown="return false"><\/span>'+'<label class="<%=labelClassName%>" style="<%=itemStyles[ index ]%>" unselectable="on" onmousedown="return false"><%=items[index]%><\/label>'+"<\/li>"+"<%}%>"+"<%if( i ) {%>"+'<li class="edui-combobox-item-separator"><\/li>'+"<%}%>"+"<%}%>"+"<%for( var i=0, label; label = items[i]; i++ ) {%>"+'<li class="<%=itemClassName%><%if( selected == i ) {%> edui-combobox-checked<%}%> edui-combobox-item-<%=i%>" data-item-index="<%=i%>" unselectable="on" onmousedown="return false">'+'<span class="edui-combobox-icon" unselectable="on" onmousedown="return false"><\/span>'+'<label class="<%=labelClassName%>" style="<%=itemStyles[ i ]%>" unselectable="on" onmousedown="return false"><%=label%><\/label>'+"<\/li>"+"<%}%>"+"<\/ul>",defaultOpt:{recordStack:[],items:[],value:[],comboboxName:"",selected:"",autoRecord:!0,recordCount:5},init:function(r){var f=this;n.extend(f._optionAdaptation(r),f._createItemMapping(r.recordStack,r.items),{itemClassName:t,iconClass:u,labelClassName:i});this._transStack(r);f.root(n(n.parseTmpl(f.tpl,r)));this.data("options",r).initEvent()},initEvent:function(){var n=this;n.initSelectItem();this.initItemActive()},initSelectItem:function(){var r=this,u="."+i;r.root().delegate("."+t,"click",function(){var i=n(this),t=i.attr("data-item-index");return r.trigger("comboboxselect",{index:t,label:i.find(u).text(),value:r.data("options").value[t]}).select(t),r.hide(),!1})},initItemActive:function(){var i={mouseenter:"addClass",mouseleave:"removeClass"};if(n.IE6)this.root().delegate("."+t,"mouseenter mouseleave",function(t){n(this)[i[t.type]](r)}).one("afterhide",function(){})},select:function(n){var t=this.data("options").itemCount,i=this.data("options").autowidthitem;return(i&&!i.length&&(i=this.data("options").items),t==0)?null:(n<0?n=t+n%t:n>=t&&(n=t-1),this.trigger("changebefore",i[n]),this._update(n),this.trigger("changeafter",i[n]),null)},selectItemByLabel:function(t){var r=this.data("options").itemMapping,u=this,i=null;n.isArray(t)||(t=[t]);n.each(t,function(n,t){return i=r[t],i!==undefined?(u.select(i),!1):void 0})},_transStack:function(t){var r=[],i=-1,u=-1;n.each(t.recordStack,function(f,e){i=t.itemMapping[e];n.isNumeric(i)&&(r.push(i),e==t.selected&&(u=i))});t.recordStack=r;t.selected=u;r=null},_optionAdaptation:function(n){if(!("itemStyles"in n)){n.itemStyles=[];for(var t=0,i=n.items.length;t<i;t++)n.itemStyles.push("")}return n.autowidthitem=n.autowidthitem||n.items,n.itemCount=n.items.length,n},_createItemMapping:function(t,i){var r={},u={recordStack:[],mapping:{}};return n.each(i,function(n,t){r[t]=n}),u.itemMapping=r,n.each(t,function(n,t){r[t]!==undefined&&(u.recordStack.push(r[t]),u.mapping[t]=r[t])}),u},_update:function(t){var i=this.data("options"),r=[],u=null;n.each(i.recordStack,function(n,i){i!=t&&r.push(i)});r.unshift(t);r.length>i.recordCount&&(r.length=i.recordCount);i.recordStack=r;i.selected=t;u=n(n.parseTmpl(this.tpl,i));this.root().html(u.html());u=null;r=null}}}(),"menu")}(),function(){UM.ui.define("buttoncombobox",function(){return{defaultOpt:{label:"",title:""},init:function(t){var i=this,r=n.eduibutton({caret:!0,name:t.comboboxName,title:t.title,text:t.label,click:function(){i.show(this.root())}});i.supper.init.call(i,t);i.on("changebefore",function(n,t){r.eduibutton("label",t)});i.data("button",r);i.attachTo(r)},button:function(){return this.data("button")}}}(),"combobox")}();UM.ui.define("modal",{tpl:'<div class="edui-modal" tabindex="-1" ><div class="edui-modal-header"><div class="edui-close" data-hide="modal"><\/div>'+'<h3 class="edui-title"><%=title%><\/h3>'+"<\/div>"+'<div class="edui-modal-body"  style="<%if(width){%>width:<%=width%>px;<%}%>'+'<%if(height){%>height:<%=height%>px;<%}%>">'+" <\/div>"+"<% if(cancellabel || oklabel) {%>"+'<div class="edui-modal-footer"><div class="edui-modal-tip"><\/div>'+'<%if(oklabel){%><div class="edui-btn edui-btn-primary" data-ok="modal"><%=oklabel%><\/div><%}%>'+'<%if(cancellabel){%><div class="edui-btn" data-hide="modal"><%=cancellabel%><\/div><%}%>'+"<\/div>"+"<%}%><\/div>",defaultOpt:{title:"",cancellabel:"",oklabel:"",width:"",height:"",backdrop:!0,keyboard:!0},init:function(t){var i=this;if(i.root(n(n.parseTmpl(i.tpl,t||{}))),i.data("options",t),t.okFn)i.on("ok",n.proxy(t.okFn,i));if(t.cancelFn)i.on("beforehide",n.proxy(t.cancelFn,i));i.root().delegate('[data-hide="modal"]',"click",n.proxy(i.hide,i)).delegate('[data-ok="modal"]',"click",n.proxy(i.ok,i));n('[data-hide="modal"],[data-ok="modal"]',i.root()).hover(function(){n(this).toggleClass("edui-hover")})},toggle:function(){var n=this;return n[n.data("isShown")?"hide":"show"]()},show:function(){var n=this;(n.trigger("beforeshow"),n.data("isShown"))||(n.data("isShown",!0),n.escape(),n.backdrop(function(){n.autoCenter();n.root().show().focus().trigger("aftershow")}))},showTip:function(t){n(".edui-modal-tip",this.root()).html(t).fadeIn()},hideTip:function(){n(".edui-modal-tip",this.root()).fadeOut(function(){n(this).html("")})},autoCenter:function(){n.IE6||this.root().css("margin-left",-(this.root().width()/2))},hide:function(){var n=this;(n.trigger("beforehide"),n.data("isShown"))&&(n.data("isShown",!1),n.escape(),n.hideModal())},escape:function(){var n=this;if(n.data("isShown")&&n.data("options").keyboard)n.root().on("keyup",function(t){t.which==27&&n.hide()});else n.data("isShown")||n.root().off("keyup")},hideModal:function(){var n=this;n.root().hide();n.backdrop(function(){n.removeBackdrop();n.trigger("afterhide")})},removeBackdrop:function(){this.$backdrop&&this.$backdrop.remove();this.$backdrop=null},backdrop:function(t){var i=this;i.data("isShown")&&i.data("options").backdrop&&(i.$backdrop=n('<div class="edui-modal-backdrop" />').click(i.data("options").backdrop=="static"?n.proxy(i.root()[0].focus,i.root()[0]):n.proxy(i.hide,i)));i.trigger("afterbackdrop");t&&t()},attachTo:function(n){var t=this;if(!n.data("$mergeObj")){n.data("$mergeObj",t.root());n.on("click",function(){t.toggle(n)});t.data("$mergeObj",n)}},ok:function(){var n=this;(n.trigger("beforeok"),n.trigger("ok",n)!==!1)&&n.hide()},getBodyContainer:function(){return this.root().find(".edui-modal-body")}});UM.ui.define("tooltip",{tpl:'<div class="edui-tooltip" unselectable="on" onmousedown="return false"><div class="edui-tooltip-arrow" unselectable="on" onmousedown="return false"><\/div><div class="edui-tooltip-inner" unselectable="on" onmousedown="return false"><\/div><\/div>',init:function(t){var i=this;i.root(n(n.parseTmpl(i.tpl,t||{})))},content:function(t){var i=this,r=n(t.currentTarget).attr("data-original-title");i.root().find(".edui-tooltip-inner").text(r)},position:function(t){var r=this,i=n(t.currentTarget);r.root().css(n.extend({display:"block"},i?{top:i.outerHeight(),left:(i.outerWidth()-r.root().outerWidth())/2}:{}))},show:function(t){if(!n(t.currentTarget).hasClass("edui-disabled")){var i=this;i.content(t);i.root().appendTo(n(t.currentTarget));i.position(t);i.root().css("display","block")}},hide:function(){var n=this;n.root().css("display","none")},attachTo:function(t){function r(t){var i=this;n.contains(document.body,i.root()[0])||i.root().appendTo(t);i.data("tooltip",i.root());t.each(function(){if(n(this).attr("data-original-title"))n(this).on("mouseenter",n.proxy(i.show,i)).on("mouseleave click",n.proxy(i.hide,i))})}var i=this;n.type(t)==="undefined"?n("[data-original-title]").each(function(t,u){r.call(i,n(u))}):t.data("tooltip")||r.call(i,t)}});UM.ui.define("tab",{init:function(t){var i=this,r=t.selector;if(n.type(r)){i.root(n(r,t.context));i.data("context",t.context);n(r,i.data("context")).on("click",function(n){i.show(n)})}},show:function(t){var i=this,r=n(t.target),s=r.closest("ul"),u,f,e,t,o;(u=r.attr("data-context"),u=u&&u.replace(/.*(?=#[^\s]*$)/,""),o=r.parent("li"),o.length&&!o.hasClass("edui-active"))&&((f=s.find(".edui-active:last a")[0],t=n.Event("beforeshow",{target:r[0],relatedTarget:f}),i.trigger(t),t.isDefaultPrevented())||(e=n(u,i.data("context")),i.activate(r.parent("li"),s),i.activate(e,e.parent(),function(){i.trigger({type:"aftershow",relatedTarget:f})})))},activate:function(t,i,r){if(t===undefined)return n(".edui-tab-item.edui-active",this.root()).index();var u=i.find("> .edui-active");u.removeClass("edui-active");t.addClass("edui-active");r&&r()}});UM.ui.define("separator",{tpl:'<div class="edui-separator" unselectable="on" onmousedown="return false" ><\/div>',init:function(t){var i=this;return i.root(n(n.parseTmpl(i.tpl,t))),i}}),function(){var e={},t={},o=[],c=null,u={},s={},h={},f=null;r.extend(UM,{defaultWidth:500,defaultHeight:500,registerUI:function(n,t){r.each(n.split(/\s+/),function(n){e[n]=t})},setEditor:function(n){t[n.id]||(t[n.id]=n)},registerWidget:function(t,i,r){u[t]=n.extend2(i,{$root:"",_preventDefault:!1,root:function(n){return this.$root||(this.$root=n)},preventDefault:function(){this._preventDefault=!0},clear:!1});r&&(s[t]=r)},getWidgetData:function(n){return u[n]},setWidgetBody:function(t,i,f){f._widgetData||r.extend(f,{_widgetData:{},getWidgetData:function(n){return this._widgetData[n]},getWidgetCallback:function(n){var t=this;return function(){return s[n].apply(t,[t,i].concat(Array.prototype.slice.call(arguments,0)))}}});var e=u[t];if(!e)return null;e=f._widgetData[t];e||(e=u[t],e=f._widgetData[t]=n.type(e)=="function"?e:r.clone(e));e.root(i.edui().getBodyContainer());e.initContent(f,i);e._preventDefault||e.initEvent(f,i);e.width&&i.width(e.width)},setActiveWidget:function(n){c=n},getEditor:function(n,i){var r=t[n]=this.createEditor(n,i);return f=f?Math.max(r.getOpt("zIndex"),f):r.getOpt("zIndex"),r},setTopEditor:function(i){n.each(t,function(n,t){i==t?i.$container&&i.$container.css("zIndex",f+1):t.$container&&t.$container.css("zIndex",t.getOpt("zIndex"))})},clearCache:function(n){t[n]&&delete t[n]},delEditor:function(n){var i;(i=t[n])&&i.destroy()},ready:function(n){o.push(n)},createEditor:function(t,i){function f(){var u=this.createUI("#"+t,r),i;r.key=t;r.ready(function(){n.each(o,function(t,i){n.proxy(i,r)()})});i=r.options;i.minFrameWidth=i.initialFrameWidth?i.initialFrameWidth:i.initialFrameWidth=r.$body.width()||UM.defaultWidth;u.css({width:i.initialFrameWidth,zIndex:r.getOpt("zIndex")});UM.browser.ie&&UM.browser.version===6&&document.execCommand("BackgroundImageCache",!1,!0);r.render(t);n.eduitooltip&&n.eduitooltip("attachTo",n("[data-original-title]",u)).css("z-index",r.getOpt("zIndex")+1);u.find("a").click(function(n){n.preventDefault()});r.fireEvent("afteruiready")}var r=new UM.Editor(i),u=this;return r.langIsReady?n.proxy(f,u)():r.addListener("langReady",n.proxy(f,u)),r},createUI:function(t,r){var f=n(t),u=n('<div class="edui-container"><div class="edui-editor-body"><\/div><\/div>').insertBefore(f),o;return r.$container=u,r.container=u[0],r.$body=f,i.ie&&i.ie9above&&(o=n('<span style="padding:0;margin:0;height:0;width:0"><\/span>'),o.insertAfter(u)),n.each(e,function(n,t){var i=t.call(r,n);i&&(h[n]=i)}),u.find(".edui-editor-body").append(f).before(this.createToolbar(r.options,r)),u.find(".edui-toolbar").append(n('<div class="edui-dialog-container"><\/div>')),u},createToolbar:function(t){var r=n.eduitoolbar(),u=r.edui(),i;return t.toolbar&&t.toolbar.length?(i=[],n.each(t.toolbar,function(t,r){n.each(r.split(/\s+/),function(t,r){if(r=="|")n.eduiseparator&&i.push(n.eduiseparator());else{var u=h[r];r=="fullscreen"?u&&i.unshift(u):u&&i.push(u)}});i.length&&u.appendToBtnmenu(i)})):r.find(".edui-btn-toolbar").remove(),r}})}();UM.registerUI("bold italic redo undo underline strikethrough superscript subscript insertorderedlist insertunorderedlist cleardoc selectall link unlink print preview justifyleft justifycenter justifyright justifyfull removeformat horizontal drafts",function(t){var r=this,i=n.eduibutton({icon:t,click:function(){r.execCommand(t)},title:this.getLang("labelMap")[t]||""});return this.addListener("selectionchange",function(){var n=this.queryCommandState(t);i.edui().disabled(n==-1).active(n==1)}),i}),function(){function i(n){var t=this;if(!n)throw new Error("invalid params, notfound editor");t.editor=n;r[n.uid]=this;n.addListener("destroy",function(){delete r[n.uid];t.editor=null})}var u={},f=["width","height","position","top","left","margin","padding","overflowX","overflowY"],e={},o={},s={},r={};UM.registerUI("fullscreen",function(t){var r=this,u=n.eduibutton({icon:"fullscreen",title:r.options.labelMap&&r.options.labelMap[t]||r.getLang("labelMap."+t),click:function(){r.execCommand(t);UM.setTopEditor(r)}});return r.addListener("selectionchange",function(){var n=this.queryCommandState(t);u.edui().disabled(n==-1).active(n==1)}),r.addListener("ready",function(){r.options.fullscreen&&i.getInstance(r).toggle()}),u});UM.commands.fullscreen={execCommand:function(){i.getInstance(this).toggle()},queryCommandState:function(){return this._edui_fullscreen_status},notNeedUndo:1};i.prototype={toggle:function(){var n=this.editor,t=this.isFullState();n.fireEvent("beforefullscreenchange",!t);this.update(!t);t?this.revert():this.enlarge();n.fireEvent("afterfullscreenchange",!t);n.body.contentEditable==="true"&&n.fireEvent("fullscreenchanged",!t);n.fireEvent("selectionchange")},enlarge:function(){this.saveSataus();this.setDocumentStatus();this.resize()},revert:function(){var t=this.editor.options,i=/%$/.test(t.initialFrameHeight)?"100%":t.initialFrameHeight-this.getStyleValue("padding-top")-this.getStyleValue("padding-bottom")-this.getStyleValue("border-width");n.IE6&&this.getEditorHolder().style.setExpression("height","this.scrollHeight <= "+i+' ? "'+i+'px" : "auto"');this.revertContainerStatus();this.revertContentAreaStatus();this.revertDocumentStatus()},update:function(n){this.editor._edui_fullscreen_status=n},resize:function(){var f=null,e=0,o=0,u=0,h=0,r=this.editor,c=this,s=null,i=null;this.isFullState()&&(f=n(window),o=f.width(),e=f.height(),i=this.getEditorHolder(),u=parseInt(t.getComputedStyle(i,"border-width"),10)||0,u+=parseInt(t.getComputedStyle(r.container,"border-width"),10)||0,h+=parseInt(t.getComputedStyle(i,"padding-left"),10)+parseInt(t.getComputedStyle(i,"padding-right"),10)||0,n.IE6&&i.style.setExpression("height",null),s=this.getBound(),n(r.container).css({width:o+"px",height:e+"px",position:n.IE6?"absolute":"fixed",top:s.top,left:s.left,margin:0,padding:0,overflowX:"hidden",overflowY:"hidden"}),n(i).css({width:o-2*u-h+"px",height:e-2*u-(r.options.withoutToolbar?0:n(".edui-toolbar",r.container).outerHeight())-n(".edui-bottombar",r.container).outerHeight()+"px",overflowX:"hidden",overflowY:"auto"}))},saveSataus:function(){for(var r=this.editor.container.style,n=null,i={},t=0,e=f.length;t<e;t++)n=f[t],i[n]=r[n];u[this.editor.uid]=i;this.saveContentAreaStatus();this.saveDocumentStatus()},saveContentAreaStatus:function(){var t=n(this.getEditorHolder());e[this.editor.uid]={width:t.css("width"),overflowX:t.css("overflowX"),overflowY:t.css("overflowY"),height:t.css("height")}},saveDocumentStatus:function(){var t=n(this.getEditorDocumentBody());o[this.editor.uid]={overflowX:t.css("overflowX"),overflowY:t.css("overflowY")};s[this.editor.uid]={overflowX:n(this.getEditorDocumentElement()).css("overflowX"),overflowY:n(this.getEditorDocumentElement()).css("overflowY")}},revertContainerStatus:function(){n(this.editor.container).css(this.getEditorStatus())},revertContentAreaStatus:function(){var t=this.getEditorHolder(),i=this.getContentAreaStatus();this.supportMin()&&(delete i.height,t.style.height=null);n(t).css(i)},revertDocumentStatus:function(){var t=this.getDocumentStatus();n(this.getEditorDocumentBody()).css("overflowX",t.body.overflowX);n(this.getEditorDocumentElement()).css("overflowY",t.html.overflowY)},setDocumentStatus:function(){n(this.getEditorDocumentBody()).css({overflowX:"hidden",overflowY:"hidden"});n(this.getEditorDocumentElement()).css({overflowX:"hidden",overflowY:"hidden"})},isFullState:function(){return!!this.editor._edui_fullscreen_status},getEditorStatus:function(){return u[this.editor.uid]},getContentAreaStatus:function(){return e[this.editor.uid]},getEditorDocumentElement:function(){return this.editor.container.ownerDocument.documentElement},getEditorDocumentBody:function(){return this.editor.container.ownerDocument.body},getEditorHolder:function(){return this.editor.body},getDocumentStatus:function(){return{body:o[this.editor.uid],html:s[this.editor.uid]}},supportMin:function(){var n=null;return this._support||(n=document.createElement("div"),this._support="minWidth"in n.style,n=null),this._support},getBound:function(){var t={html:!0,body:!0},i={top:0,left:0},r=null;return n.IE6?(r=this.editor.container.offsetParent,r&&!t[r.nodeName.toLowerCase()]&&(t=r.getBoundingClientRect(),i.top=-t.top,i.left=-t.left),i):i},getStyleValue:function(n){return parseInt(t.getComputedStyle(this.getEditorHolder(),n))}};n.extend(i,{listen:function(){var t=null;if(!i._hasFullscreenListener){i._hasFullscreenListener=!0;n(window).on("resize",function(){t!==null&&(window.clearTimeout(t),t=null);t=window.setTimeout(function(){for(var n in r)r[n].resize();t=null},50)})}},getInstance:function(n){return r[n.uid]||new i(n),r[n.uid]}});i.listen()}();UM.registerUI("link image video map formula",function(t){var i=this,e,f,u={title:i.options.labelMap&&i.options.labelMap[t]||i.getLang("labelMap."+t),url:i.options.UMEDITOR_HOME_URL+"dialogs/"+t+"/"+t+".js"},o=n.eduibutton({icon:t,title:this.getLang("labelMap")[t]||""});return r.loadFile(document,{src:u.url,tag:"script",type:"text/javascript",defer:"defer"},function(){var r=UM.getWidgetData(t),s,h;r&&(r.buttons&&(s=r.buttons.ok,s&&(u.oklabel=s.label||i.getLang("ok"),s.exec&&(u.okFn=function(){return n.proxy(s.exec,null,i,f)()})),h=r.buttons.cancel,h&&(u.cancellabel=h.label||i.getLang("cancel"),h.exec&&(u.cancelFn=function(){return n.proxy(h.exec,null,i,f)()}))),r.width&&(u.width=r.width),r.height&&(u.height=r.height),f=n.eduimodal(u),f.attr("id","edui-dialog-"+t).addClass("edui-dialog-"+t).find(".edui-modal-body").addClass("edui-dialog-"+t+"-body"),f.edui().on("beforehide",function(){var n=i.selection.getRange();n.equals(e)&&n.select()}).on("beforeshow",function(){var r=this.root(),o=null,u=null;e=i.selection.getRange();r.parent()[0]||i.$container.find(".edui-dialog-container").append(r);n.IE6&&(o={width:n(window).width(),height:n(window).height()},u=r.parents(".edui-toolbar")[0].getBoundingClientRect(),r.css({position:"absolute",margin:0,left:(o.width-r.width())/2-u.left,top:100-u.top}));UM.setWidgetBody(t,f,i);UM.setTopEditor(i)}).on("afterbackdrop",function(){this.$backdrop.css("zIndex",i.getOpt("zIndex")+1).appendTo(i.$container.find(".edui-dialog-container"));f.css("zIndex",i.getOpt("zIndex")+2)}).on("beforeok",function(){try{e.select()}catch(n){}}).attachTo(o))}),i.addListener("selectionchange",function(){var n=this.queryCommandState(t);o.edui().disabled(n==-1).active(n==1)}),o});UM.registerUI("emotion formula",function(t){var i=this,f=i.options.UMEDITOR_HOME_URL+"dialogs/"+t+"/"+t+".js",u=n.eduibutton({icon:t,title:this.getLang("labelMap")[t]||""});return r.loadFile(document,{src:f,tag:"script",type:"text/javascript",defer:"defer"},function(){var e={url:f},r=UM.getWidgetData(t);r.width&&(e.width=r.width);r.height&&(e.height=r.height);n.eduipopup(e).css("zIndex",i.options.zIndex+1).addClass("edui-popup-"+t).edui().on("beforeshow",function(){var n=this.root();n.parent().length||i.$container.find(".edui-dialog-container").append(n);UM.setWidgetBody(t,n,i);UM.setTopEditor(i)}).attachTo(u,{offsetTop:-5,offsetLeft:10,caretLeft:11,caretTop:-8});i.addListener("selectionchange",function(){var n=this.queryCommandState(t);u.edui().disabled(n==-1).active(n==1)})}),u});UM.registerUI("imagescale",function(){var t=this,r;t.setOpt("imageScaleEnabled",!0);i.webkit&&t.getOpt("imageScaleEnabled")&&(t.addListener("click",function(i,u){var h=t.selection.getRange(),f=h.getClosedNode(),c=u.target,e,o,s;if(f&&f.tagName=="IMG"&&c==f){if(!r){r=n.eduiscale({$wrap:t.$container}).css("zIndex",t.options.zIndex);t.$container.append(r);e=function(){r.edui().hide()};o=function(n){var t=n.target||n.srcElement;t&&t.className.indexOf("edui-scale")==-1&&e(n)};r.edui().on("aftershow",function(){n(document).bind("keydown",e);n(document).bind("mousedown",o);t.selection.getNative().removeAllRanges()}).on("afterhide",function(){n(document).unbind("keydown",e);n(document).unbind("mousedown",o);var i=r.edui().getScaleTarget();i.parentNode&&t.selection.getRange().selectNode(i).select()}).on("mousedown",function(n){t.selection.getNative().removeAllRanges();var i=n.target||n.srcElement;i&&i.className.indexOf("edui-scale-hand")==-1&&(s=setTimeout(function(){r.edui().hide()},200))}).on("mouseup",function(n){var t=n.target||n.srcElement;t&&t.className.indexOf("edui-scale-hand")==-1&&clearTimeout(s)})}r.edui().show(n(f))}else r&&r.css("display")!="none"&&r.edui().hide()}),t.addListener("click",function(n,i){if(i.target.tagName=="IMG"){var r=new f.Range(t.document,t.body);r.selectNode(i.target).select()}}))});UM.registerUI("autofloat",function(){var u=this,o=u.getLang(),e,f;(u.setOpt({autoFloatEnabled:!0,topOffset:0}),e=u.options.autoFloatEnabled!==!1,f=u.options.topOffset,e)&&u.ready(function(){function b(){return UM.ui?1:(alert(o.autofloatMsg),0)}function k(){var n=document.body.style;n.backgroundImage='url("about:blank")';n.backgroundAttachment="fixed"}function g(){if(!c){var r=t.getXY(e),n=t.getComputedStyle(e,"position"),o=t.getComputedStyle(e,"left");e.style.width=e.offsetWidth+"px";e.style.zIndex=u.options.zIndex*1+1;e.parentNode.insertBefore(h,e);a||w&&i.ie?(e.style.position!="absolute"&&(e.style.position="absolute"),e.style.top=(document.body.scrollTop||document.documentElement.scrollTop)-y+f+"px"):e.style.position!="fixed"&&(e.style.position="fixed",e.style.top=f+"px",(n=="absolute"||n=="relative")&&parseFloat(o)&&(e.style.left=r.x+"px"))}}function l(){h.parentNode&&h.parentNode.removeChild(h);e.style.cssText=v}function s(){var n=d(u.container),t=u.options.toolbarTopOffset||0;n.top<0&&n.bottom-e.offsetHeight>t?g():l()}var a=i.ie&&i.version<=6,w=i.quirks,v,h=document.createElement("div"),e,y,d=function(n){var i,r,u;try{i=n.getBoundingClientRect()}catch(f){i={left:0,top:0,height:0,width:0}}for(r={left:Math.round(i.left),top:Math.round(i.top),height:Math.round(i.bottom-i.top),width:Math.round(i.right-i.left)};(u=n.ownerDocument)!==document&&(n=t.getWindow(u).frameElement);)i=n.getBoundingClientRect(),r.left+=i.left,r.top+=i.top;return r.bottom=r.top+r.height,r.right=r.left+r.width,r},c=!1,p=r.defer(function(){s()},i.ie?200:100,!0);if(u.addListener("destroy",function(){n(window).off("scroll resize",s);u.removeListener("keydown",p)}),b(u)){e=n(".edui-toolbar",u.container)[0];u.addListener("afteruiready",function(){setTimeout(function(){y=n(e).offset().top},100)});v=e.style.cssText;h.style.height=e.offsetHeight+"px";a&&k();n(window).on("scroll resize",s);u.addListener("keydown",p);u.addListener("resize",function(){l();h.style.height=e.offsetHeight+"px";s()});u.addListener("beforefullscreenchange",function(n,t){t&&(l(),c=t)});u.addListener("fullscreenchanged",function(n,t){t||s();c=t});u.addListener("sourcemodechanged",function(){setTimeout(function(){s()},0)});u.addListener("clearDoc",function(){setTimeout(function(){s()},0)})}})});UM.registerUI("source",function(t){var i=this,r;return i.addListener("fullscreenchanged",function(){i.$container.find("textarea").width(i.$body.width()-10).height(i.$body.height())}),r=n.eduibutton({icon:t,click:function(){i.execCommand(t);UM.setTopEditor(i)},title:this.getLang("labelMap")[t]||""}),this.addListener("selectionchange",function(){var n=this.queryCommandState(t);r.edui().disabled(n==-1).active(n==1)}),r});UM.registerUI("paragraph fontfamily fontsize",function(t){function e(t,i){var r=n("<span>").html(t).css({display:"inline",position:"absolute",top:-1e7,left:-1e5}).appendTo(document.body),u=r.width();return r.remove(),r=null,u<50?t:(t=t.slice(0,i?-4:-1),!t.length)?"...":e(t+"...",!0)}function s(n){var i=[];for(var t in n.items)n.value.push(t),i.push(t),n.autowidthitem.push(e(t));return n.items=i,n.autoRecord=!1,n}function h(n){for(var t=null,r=[],i=0,u=n.items.length;i<u;i++)t=n.items[i].val,r.push(t.split(/\s*,\s*/)[0]),n.itemStyles.push("font-family: "+t),n.value.push(t),n.autowidthitem.push(e(r[i]));return n.items=r,n}function c(n){var i=null,r=[],t,u;for(n.itemStyles=[],n.value=[],t=0,u=n.items.length;t<u;t++)i=n.items[t],r.push(i),n.itemStyles.push("font-size: "+i+"px");return n.value=n.items,n.items=r,n.autoRecord=!1,n}var i=this,o=i.options.labelMap&&i.options.labelMap[t]||i.getLang("labelMap."+t),r={label:o,title:o,comboboxName:t,items:i.options[t]||[],itemStyles:[],value:[],autowidthitem:[]},f=null,u=null;if(r.items.length==0)return null;switch(t){case"paragraph":r=s(r);break;case"fontfamily":r=h(r);break;case"fontsize":r=c(r)}f=n.eduibuttoncombobox(r).css("zIndex",i.getOpt("zIndex")+1);u=f.edui();u.on("comboboxselect",function(n,r){i.execCommand(t,r.value)}).on("beforeshow",function(){f.parent().length===0&&f.appendTo(i.$container.find(".edui-dialog-container"));UM.setTopEditor(i)});return this.addListener("selectionchange",function(){var i=this.queryCommandState(t),n=this.queryCommandValue(t);u.button().edui().disabled(i==-1).active(i==1);n&&(n=n.replace(/['"]/g,"").toLowerCase().split(/['|"]?\s*,\s*[\1]?/),u.selectItemByLabel(n))}),u.button().addClass("edui-combobox")});UM.registerUI("forecolor backcolor",function(i){function o(){return t.getComputedStyle(e[0],"background-color")}var r=this,f=null,e=null,u=null;return this.addListener("selectionchange",function(){var n=this.queryCommandState(i);u.edui().disabled(n==-1).active(n==1)}),u=n.eduicolorsplitbutton({icon:i,caret:!0,name:i,title:r.getLang("labelMap")[i],click:function(){r.execCommand(i,o())}}),e=u.edui().colorLabel(),f=n.eduicolorpicker({name:i,lang_clearColor:r.getLang("clearColor")||"",lang_themeColor:r.getLang("themeColor")||"",lang_standardColor:r.getLang("standardColor")||""}).on("pickcolor",function(n,t){window.setTimeout(function(){e.css("backgroundColor",t);r.execCommand(i,t)},0)}).on("show",function(){UM.setActiveWidget(colorPickerWidget.root())}).css("zIndex",r.getOpt("zIndex")+1),u.edui().on("arrowclick",function(){f.parent().length||r.$container.find(".edui-dialog-container").append(f);f.edui().show(u,{caretDir:"down",offsetTop:-5,offsetLeft:8,caretLeft:11,caretTop:-8});UM.setTopEditor(r)}).register("click",u,function(){f.edui().hide()}),u})})(jQuery);
/*
//# sourceMappingURL=umeditor.min.js.map
*/